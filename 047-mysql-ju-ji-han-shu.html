<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <!-- Site Meta Data -->
  <title>047、Mysql 聚集函数</title>
  <meta name="description" content="">
  <meta name="author" content="martin">

  <!-- Style Meta Data -->
  <link rel="stylesheet" href="http://blog.smallcpp.cn/theme/css/notebook.css" type="text/css" />
  <link rel="shortcut icon" href="http://blog.smallcpp.cn/theme/images/avatar.png">

  <!-- Feed Meta Data -->
  <link href="http://blog.smallcpp.cn/" type="application/atom+xml" rel="alternate" title="Small Cpp ATOM Feed" />

  <!-- Twitter Feed -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="">
  <meta name="twitter:image" content="http://blog.smallcpp.cn/theme/images/avatar.png">

<meta name="twitter:creator" content="">
<meta name="twitter:url" content="http://blog.smallcpp.cn/047-mysql-ju-ji-han-shu.html">
<meta name="twitter:title" content="Small Cpp ~ 047、Mysql 聚集函数">
<meta name="twitter:description" content="聚集函数和分组">

<!-- Facebook Meta Data -->
<meta property="og:title" content="Small Cpp ~ 047、Mysql 聚集函数" />
<meta property="og:description" content="聚集函数和分组" />
<meta property="og:image" content="theme/images/avatar.png" />
</head>

<body>
  <!-- Sidebar -->
  <aside>
    <p><a href="http://blog.smallcpp.cn"><img id="avatar" src="http://blog.smallcpp.cn/theme/images/avatar.png"></a></p>
    <h1>Small Cpp</h1>
    <p>勿在浮沙筑高台, 练从难处练, 用从易处用.</p>
    <hr>
    <h2>Social</h2>
    <ul class="social">
      <a href="http://blog.csdn.net/u010850265">CSDN</a></li>
    </ul>
    <h2>Categories</h2>
    <ul class="navbar">
      <li><a href="http://blog.smallcpp.cn/category/c11.html">C++11</a></li>
      <li><a href="http://blog.smallcpp.cn/category/da-shu-ju.html">大数据</a></li>
      <li><a href="http://blog.smallcpp.cn/category/du-shu-bi-ji.html">读书笔记</a></li>
      <li><a href="http://blog.smallcpp.cn/category/golang.html">Golang</a></li>
      <li><a href="http://blog.smallcpp.cn/category/hei-ke-ji.html">黑科技</a></li>
      <li class="active"><a href="http://blog.smallcpp.cn/category/java.html">Java</a></li>
      <li><a href="http://blog.smallcpp.cn/category/linux.html">Linux</a></li>
      <li><a href="http://blog.smallcpp.cn/category/lua.html">Lua</a></li>
      <li><a href="http://blog.smallcpp.cn/category/mongodb.html">Mongodb</a></li>
      <li><a href="http://blog.smallcpp.cn/category/pyqt.html">PyQt</a></li>
      <li><a href="http://blog.smallcpp.cn/category/python.html">Python</a></li>
      <li><a href="http://blog.smallcpp.cn/category/qt.html">QT</a></li>
      <li><a href="http://blog.smallcpp.cn/category/qu-kuai-lian.html">区块链</a></li>
      <li><a href="http://blog.smallcpp.cn/category/redis.html">Redis</a></li>
      <li><a href="http://blog.smallcpp.cn/category/ruan-jian-she-ji.html">软件设计</a></li>
      <li><a href="http://blog.smallcpp.cn/category/za-xiang.html">杂项</a></li>
    </ul> 
  </aside>

  <!-- Content -->
  <article>
<section id="content">
    <article>
        <header class="post_list">
            <h2 class="post_title"><a href="http://blog.smallcpp.cn/047-mysql-ju-ji-han-shu.html" rel="bookmark" title="Permalink to 047、Mysql 聚集函数">047、Mysql 聚集函数</a></h2>
            <span>Par </span>
            <a href="http://blog.smallcpp.cn/author/martin.html">@Martin</a>
            <span> dans </span>
            <span class="post_category"><a href="http://blog.smallcpp.cn/category/java.html" rel="bookmark" title="Permalink to Java">[ Java ]</a></span>
            <span> le </span>
            <span class="post_date">Mon 25 July 2016</span>
            <div></div>
            <div><span>Tags : </span>
            </div>
        </header>
        <div class="entry-content">
            <div class="toc">
<ul>
<li><a href="#group-by">GROUP BY 用法解析</a></li>
<li><a href="#where-group-by">将 WHERE 子句与 GROUP BY 子句一起使用</a></li>
<li><a href="#group-by-having">在 GROUP BY 子句之后使用 HAVING 子句</a></li>
</ul>
</div>
<p>Mysql 聚集函数有 5 个:</p>
<ul>
<li>COUNT() 记录个数</li>
<li>MAX() 最大值</li>
<li>MIN() 最小值</li>
<li>AVG() 平均值</li>
<li>SUM() 求和</li>
</ul>
<p>聚集函数常常和分组一起工作.</p>
<h1 id="group-by">GROUP BY 用法解析</h1>
<p><code>GROUP BY</code> 语法可以根据给定数据列的每个成员对查询结果进行分组统计, 最终得到一个分组汇总表.</p>
<p><code>SELECT</code> 子句中的列名必须为分组列或列函数 (列函数对于 <code>GROUP BY</code> 子句定义的每个组各返回一个结果.).</p>
<p>例子:</p>
<p>某个员工信息表结构和数据如下:</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>dept</th>
<th>salary</th>
<th>edlevel</th>
<th>hiredate</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>张三</td>
<td>开发部</td>
<td>2000</td>
<td>3</td>
<td>2009-10-11</td>
</tr>
<tr>
<td>2</td>
<td>李四</td>
<td>开发部</td>
<td>2500</td>
<td>3</td>
<td>2009-10-01</td>
</tr>
<tr>
<td>3</td>
<td>王五</td>
<td>设计部</td>
<td>2600</td>
<td>5</td>
<td>2010-10-02</td>
</tr>
<tr>
<td>4</td>
<td>王六</td>
<td>设计部</td>
<td>2300</td>
<td>4</td>
<td>2010-10-03</td>
</tr>
<tr>
<td>5</td>
<td>马七</td>
<td>设计部</td>
<td>2100</td>
<td>4</td>
<td>2010-10-06</td>
</tr>
<tr>
<td>6</td>
<td>赵八</td>
<td>销售部</td>
<td>3000</td>
<td>5</td>
<td>2010-10-05</td>
</tr>
<tr>
<td>7</td>
<td>钱九</td>
<td>销售部</td>
<td>3100</td>
<td>7</td>
<td>2010-10-07</td>
</tr>
<tr>
<td>8</td>
<td>孙十</td>
<td>销售部</td>
<td>3500</td>
<td>7</td>
<td>2010-10-06</td>
</tr>
</tbody>
</table>
<p>例如, 我想列出每个部门最高薪水的结果, sql 语句如下:</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span><span style="color: #8B008B; font-weight: bold">SELECT</span> DEPT, <span style="color: #8B008B; font-weight: bold">MAX</span>(SALARY) <span style="color: #8B008B; font-weight: bold">AS</span> MAXIMUM <span style="color: #8B008B; font-weight: bold">FROM</span> STAFF <span style="color: #8B008B; font-weight: bold">GROUP</span> <span style="color: #8B008B; font-weight: bold">BY</span> DEPT
</pre></div>


<p><br>
查询结果如下:</p>
<table>
<thead>
<tr>
<th>DEPT</th>
<th>MAXIMUM</th>
</tr>
</thead>
<tbody>
<tr>
<td>开发部</td>
<td>2500</td>
</tr>
<tr>
<td>设计部</td>
<td>2600</td>
</tr>
<tr>
<td>销售部</td>
<td>3500</td>
</tr>
</tbody>
</table>
<p>解释一下这个结果:</p>
<ul>
<li>满足 &ldquo;SELECT 子句中的列名必须为分组列或列函数&rdquo;, 因为 <code>SELECT</code> 有 <code>GROUP BY DEPT</code> 中包含的列 DEPT.</li>
<li>&ldquo;列函数对于 GROUP BY 子句定义的每个组各返回一个结果&rdquo;, 根据部门分组, 对每个部门返回一个结果, 就是每个部门的最高薪水.</li>
</ul>
<blockquote>
<p>注意: 计算的是每个部门 (由 <code>GROUP BY</code> 子句定义的组) 而不是整个公司的 <code>MAX(SALARY)</code>.</p>
</blockquote>
<p>例如, 查询每个部门的总的薪水数:</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span><span style="color: #8B008B; font-weight: bold">SELECT</span> DEPT, <span style="color: #8B008B; font-weight: bold">sum</span>(SALARY) <span style="color: #8B008B; font-weight: bold">AS</span> total <span style="color: #8B008B; font-weight: bold">FROM</span> STAFF <span style="color: #8B008B; font-weight: bold">GROUP</span> <span style="color: #8B008B; font-weight: bold">BY</span> DEPT
</pre></div>


<p><br>
查询结果如下:</p>
<table>
<thead>
<tr>
<th>DEPT</th>
<th>MAXIMUM</th>
</tr>
</thead>
<tbody>
<tr>
<td>开发部</td>
<td>4500</td>
</tr>
<tr>
<td>设计部</td>
<td>7000</td>
</tr>
<tr>
<td>销售部</td>
<td>9600</td>
</tr>
</tbody>
</table>
<h1 id="where-group-by">将 WHERE 子句与 GROUP BY 子句一起使用</h1>
<p>分组查询可以在形成组和计算列函数<strong>之前</strong>使用具有消除非限定行的标准 <code>WHERE</code> 子句 (必须在 <code>GROUP BY</code> 子句之前指定 <code>WHERE</code> 子句).</p>
<p>例如, 查询公司 2010 年入职的各个部门每个级别里的最高薪水:</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span><span style="color: #8B008B; font-weight: bold">SELECT</span> DEPT, EDLEVEL, <span style="color: #8B008B; font-weight: bold">MAX</span>(SALARY) <span style="color: #8B008B; font-weight: bold">AS</span> MAXIMUM <span style="color: #8B008B; font-weight: bold">FROM</span> staff <span style="color: #8B008B; font-weight: bold">WHERE</span> HIREDATE &gt; <span style="color: #CD5555">&#39;2010-01-01&#39;</span> <span style="color: #8B008B; font-weight: bold">GROUP</span> <span style="color: #8B008B; font-weight: bold">BY</span> DEPT, EDLEVEL <span style="color: #8B008B; font-weight: bold">ORDER</span> <span style="color: #8B008B; font-weight: bold">BY</span> DEPT, EDLEVEL
</pre></div>


<p><br>
查询结果如下:</p>
<table>
<thead>
<tr>
<th>DEPT</th>
<th>EDLEVEL</th>
<th>MAXIMUM</th>
</tr>
</thead>
<tbody>
<tr>
<td>设计部</td>
<td>4</td>
<td>2300</td>
</tr>
<tr>
<td>设计部</td>
<td>5</td>
<td>2600</td>
</tr>
<tr>
<td>销售部</td>
<td>5</td>
<td>3000</td>
</tr>
<tr>
<td>销售部</td>
<td>7</td>
<td>3500</td>
</tr>
</tbody>
</table>
<blockquote>
<p>注意: 在 <code>SELECT</code> 语句中指定的每个列名也在 <code>GROUP BY</code> 子句中提到(未在这两个地方提到的列名将产生错误).</p>
</blockquote>
<p><code>GROUP BY</code> 子句对 <code>DEPT</code> 和 <code>EDLEVEL</code> 的每个<strong>唯一组合</strong>各返回一行.</p>
<h1 id="group-by-having">在 GROUP BY 子句之后使用 HAVING 子句</h1>
<p><code>where</code> 子句的作用是在对查询结果进行分组前, 将不符合 <code>where</code> 条件的行去掉, 即在分组之前过滤数据, 条件中不能包含聚组函数, 使用where条件显示特定的行.</p>
<p><code>having</code> 子句的作用是筛选满足条件的组, 即在分组之后过滤数据, 条件中经常包含聚集函数, 使用 <code>having</code> 条件显示特定的组, 也可以使用多个分组标准进行分组.</p>
<p><code>having</code> 子句被限制子已经在SELECT语句中定义的列和聚合表达式上.</p>
<p>例如: 寻找雇员数超过2个的部门的最高和最低薪水:</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span><span style="color: #8B008B; font-weight: bold">SELECT</span> DEPT, <span style="color: #8B008B; font-weight: bold">MAX</span>(SALARY) <span style="color: #8B008B; font-weight: bold">AS</span> MAXIMUM, <span style="color: #8B008B; font-weight: bold">MIN</span>(SALARY) <span style="color: #8B008B; font-weight: bold">AS</span> MINIMUM <span style="color: #8B008B; font-weight: bold">FROM</span> staff <span style="color: #8B008B; font-weight: bold">GROUP</span> <span style="color: #8B008B; font-weight: bold">BY</span> DEPT <span style="color: #8B008B; font-weight: bold">HAVING</span> <span style="color: #8B008B; font-weight: bold">COUNT</span>(*) &gt;<span style="color: #B452CD">2</span> <span style="color: #8B008B; font-weight: bold">ORDER</span> <span style="color: #8B008B; font-weight: bold">BY</span> DEPT
</pre></div>


<p><br>
查询结果如下:</p>
<table>
<thead>
<tr>
<th>DEPT</th>
<th>MAXIMUM</th>
<th>MINIMUM</th>
</tr>
</thead>
<tbody>
<tr>
<td>设计部</td>
<td>2600</td>
<td>2100</td>
</tr>
<tr>
<td>销售部</td>
<td>3500</td>
<td>3000</td>
</tr>
</tbody>
</table>
<p>例如: 寻找雇员平均工资大于3000的部门的最高和最低薪水:</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span><span style="color: #8B008B; font-weight: bold">SELECT</span> DEPT, <span style="color: #8B008B; font-weight: bold">MAX</span>(SALARY) <span style="color: #8B008B; font-weight: bold">AS</span> MAXIMUM, <span style="color: #8B008B; font-weight: bold">MIN</span>(SALARY) <span style="color: #8B008B; font-weight: bold">AS</span> MINIMUM <span style="color: #8B008B; font-weight: bold">FROM</span> staff <span style="color: #8B008B; font-weight: bold">GROUP</span> <span style="color: #8B008B; font-weight: bold">BY</span> DEPT <span style="color: #8B008B; font-weight: bold">HAVING</span> <span style="color: #8B008B; font-weight: bold">AVG</span>(SALARY) &gt;<span style="color: #B452CD">3000</span> <span style="color: #8B008B; font-weight: bold">ORDER</span> <span style="color: #8B008B; font-weight: bold">BY</span> DEPT
</pre></div>


<p><br>
查询结果如下:</p>
<table>
<thead>
<tr>
<th>DEPT</th>
<th>MAXIMUM</th>
<th>MINIMUM</th>
</tr>
</thead>
<tbody>
<tr>
<td>销售部</td>
<td>3500</td>
<td>3000</td>
</tr>
</tbody>
</table>
            <div align="center" style="color:#ccc;">☠</div>
        </div>
    </article>
</section>
  </article>


</body>
</html>