<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <!-- Site Meta Data -->
  <title>034、对象流 (对象的序列化)</title>
  <meta name="description" content="">
  <meta name="author" content="martin">

  <!-- Style Meta Data -->
  <link rel="stylesheet" href="http://blog.smallcpp.cn/theme/css/notebook.css" type="text/css" />
  <link rel="shortcut icon" href="http://blog.smallcpp.cn/theme/images/avatar.png">

  <!-- Feed Meta Data -->
  <link href="http://blog.smallcpp.cn/" type="application/atom+xml" rel="alternate" title="Small Cpp ATOM Feed" />

  <!-- Twitter Feed -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="">
  <meta name="twitter:image" content="http://blog.smallcpp.cn/theme/images/avatar.png">

<meta name="twitter:creator" content="">
<meta name="twitter:url" content="http://blog.smallcpp.cn/034-dui-xiang-liu-dui-xiang-de-xu-lie-hua.html">
<meta name="twitter:title" content="Small Cpp ~ 034、对象流 (对象的序列化)">
<meta name="twitter:description" content="如何使用 Java 对象流实现对象的序列化 (又叫串行化) 与反序列化, Java 序列化是指把 Java 对象转换为字节序列的过程, 而 Java 反序列化是指把字节序列恢复为 Java 对象的过程.">

<!-- Facebook Meta Data -->
<meta property="og:title" content="Small Cpp ~ 034、对象流 (对象的序列化)" />
<meta property="og:description" content="如何使用 Java 对象流实现对象的序列化 (又叫串行化) 与反序列化, Java 序列化是指把 Java 对象转换为字节序列的过程, 而 Java 反序列化是指把字节序列恢复为 Java 对象的过程." />
<meta property="og:image" content="theme/images/avatar.png" />
</head>

<body>
  <!-- Sidebar -->
  <aside>
    <p><a href="http://blog.smallcpp.cn"><img id="avatar" src="http://blog.smallcpp.cn/theme/images/avatar.png"></a></p>
    <h1>Small Cpp</h1>
    <p>勿在浮沙筑高台, 练从难处练, 用从易处用.</p>
    <hr>
    <h2>Social</h2>
    <ul class="social">
      <a href="http://blog.csdn.net/u010850265">CSDN</a></li>
    </ul>
    <h2>Categories</h2>
    <ul class="navbar">
      <li><a href="http://blog.smallcpp.cn/category/c11.html">C++11</a></li>
      <li><a href="http://blog.smallcpp.cn/category/da-shu-ju.html">大数据</a></li>
      <li><a href="http://blog.smallcpp.cn/category/du-shu-bi-ji.html">读书笔记</a></li>
      <li><a href="http://blog.smallcpp.cn/category/golang.html">Golang</a></li>
      <li><a href="http://blog.smallcpp.cn/category/hei-ke-ji.html">黑科技</a></li>
      <li class="active"><a href="http://blog.smallcpp.cn/category/java.html">Java</a></li>
      <li><a href="http://blog.smallcpp.cn/category/linux.html">Linux</a></li>
      <li><a href="http://blog.smallcpp.cn/category/lua.html">Lua</a></li>
      <li><a href="http://blog.smallcpp.cn/category/mongodb.html">Mongodb</a></li>
      <li><a href="http://blog.smallcpp.cn/category/pyqt.html">PyQt</a></li>
      <li><a href="http://blog.smallcpp.cn/category/python.html">Python</a></li>
      <li><a href="http://blog.smallcpp.cn/category/qt.html">QT</a></li>
      <li><a href="http://blog.smallcpp.cn/category/qu-kuai-lian.html">区块链</a></li>
      <li><a href="http://blog.smallcpp.cn/category/redis.html">Redis</a></li>
      <li><a href="http://blog.smallcpp.cn/category/ruan-jian-she-ji.html">软件设计</a></li>
      <li><a href="http://blog.smallcpp.cn/category/za-xiang.html">杂项</a></li>
    </ul> 
  </aside>

  <!-- Content -->
  <article>
<section id="content">
    <article>
        <header class="post_list">
            <h2 class="post_title"><a href="http://blog.smallcpp.cn/034-dui-xiang-liu-dui-xiang-de-xu-lie-hua.html" rel="bookmark" title="Permalink to 034、对象流 (对象的序列化)">034、对象流 (对象的序列化)</a></h2>
            <span>Par </span>
            <a href="http://blog.smallcpp.cn/author/martin.html">@Martin</a>
            <span> dans </span>
            <span class="post_category"><a href="http://blog.smallcpp.cn/category/java.html" rel="bookmark" title="Permalink to Java">[ Java ]</a></span>
            <span> le </span>
            <span class="post_date">Thu 07 July 2016</span>
            <div></div>
            <div><span>Tags : </span>
            </div>
        </header>
        <div class="entry-content">
            <div class="toc">
<ul>
<li><a href="#api">序列化 API</a></li>
<li><a href="#_1">实现序列化的要求</a></li>
<li><a href="#java">实现 Java 对象序列化与反序列化的方法</a><ul>
<li><a href="#_2">方法一</a></li>
<li><a href="#_3">方法二</a></li>
<li><a href="#_4">方法三</a></li>
</ul>
</li>
<li><a href="#jdk">JDK 类库中序列化的步骤</a></li>
<li><a href="#jdk_1">JDK 类库中反序列化的步骤</a></li>
<li><a href="#_5">类的版本</a></li>
<li><a href="#_6">实例</a></li>
</ul>
</div>
<p>Java 序列化与反序列化 (又叫串行化与反串行化)</p>
<p>Java 序列化是指把 Java 对象转换为字节序列的过程, 而 Java 反序列化是指把字节序列恢复为 Java 对象的过程.</p>
<h1 id="api">序列化 API</h1>
<p><code>java.io.ObjectOutputStream</code>: 表示对象输出流</p>
<p>它的 <code>writeObject(Object obj)</code> 方法可以对参数指定的 obj 对象进行序列化, 把得到的字节序列写到一个目标输出流中.</p>
<p><code>java.io.ObjectInputStream</code>: 表示对象输入流</p>
<p>它的 <code>readObject()</code> 方法源输入流中读取字节序列, 再把它们反序列化成为一个对象, 并将其返回.</p>
<h1 id="_1">实现序列化的要求</h1>
<p>只有实现了 <code>Serializable</code> 或 <code>Externalizable</code> 接口的类的对象才能被序列化, 否则抛出异常.</p>
<h1 id="java">实现 Java 对象序列化与反序列化的方法</h1>
<p>假定一个 Student 类, 它的对象需要序列化, 可以有如下三种方法:</p>
<h2 id="_2">方法一</h2>
<p>若 Student 类仅仅实现了 <code>Serializable</code> 接口, 则可以按照以下方式进行序列化和反序列化.</p>
<p><code>ObjectOutputStream</code> 采用默认的序列化方式, 对 Student 对象的非 <code>transient</code> 的实例变量进行序列化.</p>
<p><code>ObjcetInputStream</code> 采用默认的反序列化方式, 对 Student 对象的非 <code>transient</code> 的实例变量进行反序列化.</p>
<blockquote>
<p>transient 是 Java 语言的关键字, 用来表示一个域不是该对象串行化的一部分, 当一个对象被串行化的时候, transient 型变量的值不包括在串行化的表示中, 然而非 transient 型的变量是被包括进去的.</p>
</blockquote>
<h2 id="_3">方法二</h2>
<p>若 Student 类仅仅实现了 <code>Serializable</code> 接口, 并且还定义了 <code>readObject(ObjectInputStream in)</code> 和 <code>writeObject(ObjectOutputSteam out)</code>, 则采用以下方式进行序列化与反序列化.</p>
<p><code>ObjectOutputStream</code> 会调用 Student 对象的 <code>writeObject(ObjectOutputStream out)</code> 的方法进行序列化.</p>
<p><code>ObjectInputStream</code> 会调用 Student 对象的 <code>readObject(ObjectInputStream in)</code> 的方法进行反序列化.</p>
<h2 id="_4">方法三</h2>
<p>若 Student 类实现了 <code>Externalnalizable</code> 接口, 且 <code>Student</code> 类必须实现 <code>readExternal(ObjectInput in)</code> 和 <code>writeExternal(ObjectOutput out)</code> 方法, 则按照以下方式进行序列化与反序列化.</p>
<p><code>ObjectOutputStream</code> 会调用 Student 对象的 <code>writeExternal(ObjectOutput out)</code> 的方法进行序列化.</p>
<p><code>ObjectInputStream</code> 会调用 Student 对象的 <code>readExternal(ObjectInput in)</code> 的方法进行反序列化.</p>
<h1 id="jdk">JDK 类库中序列化的步骤</h1>
<p>步骤一:<br>
创建一个对象输出流, 它可以包装一个其它类型的目标输出流, 如文件输出流:</p>
<p><code>ObjectOutputStream out = new ObjectOutputStream(new fileOutputStream("D:\\objectfile.obj"));</code></p>
<p>步骤二:<br>
通过对象输出流的 <code>writeObject()</code> 方法写对象:</p>
<p><code>out.writeObject("Hello");</code></p>
<p><code>out.writeObject(new Date());</code></p>
<h1 id="jdk_1">JDK 类库中反序列化的步骤</h1>
<p>步骤一:<br>
创建一个对象输入流, 它可以包装一个其它类型输入流, 如文件输入流:</p>
<p><code>ObjectInputStream in = new ObjectInputStream(new fileInputStream("D:\\objectfile.obj"));</code></p>
<p>步骤二:<br>
通过对象输出流的 <code>readObject()</code> 方法读取对象:</p>
<p><code>String obj1 = (String)in.readObject();</code></p>
<p><code>Date obj2 = (Date)in.readObject();</code></p>
<p>说明:<br>
为了正确读取数据, 完成反序列化, 必须保证向对象输出流写对象的顺序与从对象输入流中读对象的<strong>顺序一致</strong>.</p>
<h1 id="_5">类的版本</h1>
<p>考虑一种情况, 假设定义了一个类, 实现了 Serializable, 并且序列化了这个类的实例, 如果这时, 改变了该类的结构, 那么反序列化就会报错, 提供类的版本 ID 不兼容.</p>
<p>所谓的版本 ID, 就是类的 <code>private static final long serialVersionUID</code> 变量, 如果没有定义这个 <code>serialVersionUID</code>, 类也会自动生成, 但只要改变了类的结构, <code>serialVersionUID</code> 也会跟着改变.</p>
<p>为此, 我们可以手动为类添加版本 ID: <code>private static final long serialVersionUID = xxxxL;</code></p>
<h1 id="_6">实例</h1>
<p>为了更好地理解 Java 序列化与反序列化, 选择<strong>方法一</strong>编码实现.</p>
<p>Student 类定义如下:</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span><span style="color: #8B008B; font-weight: bold">package</span> <span style="color: #008b45; text-decoration: underline">com.jieke.io</span>;
<span style="color: #8B008B; font-weight: bold">import</span> <span style="color: #008b45; text-decoration: underline">java.io.Serializable</span>;

<span style="color: #228B22">/**</span>
<span style="color: #228B22"> *Title:学生类</span>
<span style="color: #228B22"> *Description:实现序列化接口的学生类</span>
<span style="color: #228B22"> *Copyright: copyright(c) 2012</span>
<span style="color: #228B22"> *Filename: Student.java</span>
<span style="color: #228B22"> *@author Wang Luqing</span>
<span style="color: #228B22"> *@version 1.0</span>
<span style="color: #228B22"> */</span>
<span style="color: #8B008B; font-weight: bold">public</span> <span style="color: #8B008B; font-weight: bold">class</span> <span style="color: #008b45; font-weight: bold">Student</span> <span style="color: #8B008B; font-weight: bold">implements</span> Serializable {
 <span style="color: #8B008B; font-weight: bold">private</span> String name;
 <span style="color: #8B008B; font-weight: bold">private</span> <span style="color: #00688B; font-weight: bold">char</span> sex;
 <span style="color: #8B008B; font-weight: bold">private</span> <span style="color: #00688B; font-weight: bold">int</span> year;
 <span style="color: #8B008B; font-weight: bold">private</span> <span style="color: #00688B; font-weight: bold">double</span> gpa;

 <span style="color: #8B008B; font-weight: bold">public</span> <span style="color: #008b45">Student</span>() {

 }

 <span style="color: #8B008B; font-weight: bold">public</span> <span style="color: #008b45">Student</span>(String name,<span style="color: #00688B; font-weight: bold">char</span> sex,<span style="color: #00688B; font-weight: bold">int</span> year,<span style="color: #00688B; font-weight: bold">double</span> gpa) {
  <span style="color: #8B008B; font-weight: bold">this</span>.<span style="color: #658b00">name</span> = name;
  <span style="color: #8B008B; font-weight: bold">this</span>.<span style="color: #658b00">sex</span> = sex;
  <span style="color: #8B008B; font-weight: bold">this</span>.<span style="color: #658b00">year</span> = year;
  <span style="color: #8B008B; font-weight: bold">this</span>.<span style="color: #658b00">gpa</span> = gpa;
 }

 <span style="color: #8B008B; font-weight: bold">public</span> <span style="color: #00688B; font-weight: bold">void</span> <span style="color: #008b45">setName</span>(String name) {
  <span style="color: #8B008B; font-weight: bold">this</span>.<span style="color: #658b00">name</span> = name;
 }

 <span style="color: #8B008B; font-weight: bold">public</span> <span style="color: #00688B; font-weight: bold">void</span> <span style="color: #008b45">setSex</span>(<span style="color: #00688B; font-weight: bold">char</span> sex) {
  <span style="color: #8B008B; font-weight: bold">this</span>.<span style="color: #658b00">sex</span> = sex;
 }

 <span style="color: #8B008B; font-weight: bold">public</span> <span style="color: #00688B; font-weight: bold">void</span> <span style="color: #008b45">setYear</span>(<span style="color: #00688B; font-weight: bold">int</span> year) {
  <span style="color: #8B008B; font-weight: bold">this</span>.<span style="color: #658b00">year</span> = year;
 }

 <span style="color: #8B008B; font-weight: bold">public</span> <span style="color: #00688B; font-weight: bold">void</span> <span style="color: #008b45">setGpa</span>(<span style="color: #00688B; font-weight: bold">double</span> gpa) {
  <span style="color: #8B008B; font-weight: bold">this</span>.<span style="color: #658b00">gpa</span> = gpa;
 }

 <span style="color: #8B008B; font-weight: bold">public</span> String <span style="color: #008b45">getName</span>() {
  <span style="color: #8B008B; font-weight: bold">return</span> <span style="color: #8B008B; font-weight: bold">this</span>.<span style="color: #658b00">name</span>;
 }

 <span style="color: #8B008B; font-weight: bold">public</span> <span style="color: #00688B; font-weight: bold">char</span> <span style="color: #008b45">getSex</span>() {
  <span style="color: #8B008B; font-weight: bold">return</span> <span style="color: #8B008B; font-weight: bold">this</span>.<span style="color: #658b00">sex</span>;
 }

 <span style="color: #8B008B; font-weight: bold">public</span> <span style="color: #00688B; font-weight: bold">int</span> <span style="color: #008b45">getYear</span>() {
  <span style="color: #8B008B; font-weight: bold">return</span> <span style="color: #8B008B; font-weight: bold">this</span>.<span style="color: #658b00">year</span>;
 }

 <span style="color: #8B008B; font-weight: bold">public</span> <span style="color: #00688B; font-weight: bold">double</span> <span style="color: #008b45">getGpa</span>() {
  <span style="color: #8B008B; font-weight: bold">return</span> <span style="color: #8B008B; font-weight: bold">this</span>.<span style="color: #658b00">gpa</span>;
 }
}
</pre></div>


<p><br>
把 Student 类的对象序列化到文件 <code>O:\\Java\\com\\jieke\\io\\student.txt</code>, 并从该文件中反序列化, 向 <strong>console</strong> 显示结果. 代码如下:</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span><span style="color: #8B008B; font-weight: bold">import</span> <span style="color: #008b45; text-decoration: underline">java.io.*</span>;

<span style="color: #228B22">/**</span>
<span style="color: #228B22"> *Title:应用学生类</span>
<span style="color: #228B22"> *Description:实现学生类实例的序列化与反序列化</span>
<span style="color: #228B22"> *Copyright: copyright(c) 2012</span>
<span style="color: #228B22"> *Filename: UseStudent.java</span>
<span style="color: #228B22"> *@author Wang Luqing</span>
<span style="color: #228B22"> *@version 1.0</span>
<span style="color: #228B22"> */</span>

<span style="color: #8B008B; font-weight: bold">public</span> <span style="color: #8B008B; font-weight: bold">class</span> <span style="color: #008b45; font-weight: bold">UseStudent</span> {
 <span style="color: #8B008B; font-weight: bold">public</span> <span style="color: #8B008B; font-weight: bold">static</span> <span style="color: #00688B; font-weight: bold">void</span> <span style="color: #008b45">main</span>(String[] args) {
  Student st = <span style="color: #8B008B; font-weight: bold">new</span> Student(<span style="color: #CD5555">&quot;Tom&quot;</span>,<span style="color: #CD5555">&#39;M&#39;</span>,<span style="color: #B452CD">20</span>,<span style="color: #B452CD">3.6</span>);
  File file = <span style="color: #8B008B; font-weight: bold">new</span> File(<span style="color: #CD5555">&quot;O:\\Java\\com\\jieke\\io\\student.txt&quot;</span>);
  <span style="color: #8B008B; font-weight: bold">try</span> {
   file.<span style="color: #658b00">createNewFile</span>();
  } <span style="color: #8B008B; font-weight: bold">catch</span>(IOException e) {
   e.<span style="color: #658b00">printStackTrace</span>();
  }

  <span style="color: #8B008B; font-weight: bold">try</span> {
   <span style="color: #228B22">//Student对象序列化过程</span>
   FileOutputStream fos = <span style="color: #8B008B; font-weight: bold">new</span> FileOutputStream(file);
   ObjectOutputStream oos = <span style="color: #8B008B; font-weight: bold">new</span> ObjectOutputStream(fos);
   oos.<span style="color: #658b00">writeObject</span>(st);
   oos.<span style="color: #658b00">flush</span>();
   oos.<span style="color: #658b00">close</span>();
   fos.<span style="color: #658b00">close</span>();

   <span style="color: #228B22">//Student对象反序列化过程</span>
   FileInputStream fis = <span style="color: #8B008B; font-weight: bold">new</span> FileInputStream(file);
   ObjectInputStream ois = <span style="color: #8B008B; font-weight: bold">new</span> ObjectInputStream(fis);
   Student st1 = (Student) ois.<span style="color: #658b00">readObject</span>();
   System.<span style="color: #658b00">out</span>.<span style="color: #658b00">println</span>(<span style="color: #CD5555">&quot;name = &quot;</span> + st1.<span style="color: #658b00">getName</span>());
   System.<span style="color: #658b00">out</span>.<span style="color: #658b00">println</span>(<span style="color: #CD5555">&quot;sex = &quot;</span> + st1.<span style="color: #658b00">getSex</span>());
   System.<span style="color: #658b00">out</span>.<span style="color: #658b00">println</span>(<span style="color: #CD5555">&quot;year = &quot;</span> + st1.<span style="color: #658b00">getYear</span>());
   System.<span style="color: #658b00">out</span>.<span style="color: #658b00">println</span>(<span style="color: #CD5555">&quot;gpa = &quot;</span> + st1.<span style="color: #658b00">getGpa</span>());
   ois.<span style="color: #658b00">close</span>();
   fis.<span style="color: #658b00">close</span>();
  } <span style="color: #8B008B; font-weight: bold">catch</span>(ClassNotFoundException e) {
   e.<span style="color: #658b00">printStackTrace</span>();
  } <span style="color: #8B008B; font-weight: bold">catch</span> (IOException e) {
   e.<span style="color: #658b00">printStackTrace</span>();
  }
 }
}
</pre></div>


<p><br>
结果如下所示:</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span>name = Tom

sex = M

year = 20

gpa = 3.6
</pre></div>


<p><br>
总结:</p>
<ul>
<li>Java 序列化就是把对象转换成字节序列, 而 Java 反序列化就是把字节序列还原成 Java 对象.</li>
<li>采用 Java 序列化与反序列化技术,<ul>
<li>一是可以实现数据的持久化, 在 MVC 模式中很是有用;</li>
<li>二是可以对象数据的远程通信.</li>
</ul>
</li>
</ul>
            <div align="center" style="color:#ccc;">☠</div>
        </div>
    </article>
</section>
  </article>


</body>
</html>