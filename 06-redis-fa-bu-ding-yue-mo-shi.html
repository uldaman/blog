<!DOCTYPE html>
<head>
    <meta charset="utf-8" />
    <!-- Set the viewport width to device width for mobile -->
    <meta name="viewport" content="width=device-width" />

    <title>06、Redis 发布订阅模式</title>

    <link rel="stylesheet" href="http://blog.smallcpp.com/theme/css/normalize.css" />
    <link rel="stylesheet" href="http://blog.smallcpp.com/theme/css/foundation.min.css" />
    <link rel="stylesheet" href="http://blog.smallcpp.com/theme/css/style.css" />
    <link rel="stylesheet" href="http://blog.smallcpp.com/theme/css/pygments.css" />
    <link rel="shortcut icon" type="image/x-icon" href="http://blog.smallcpp.com/theme/images/favicon.ico" />
    <script src="http://blog.smallcpp.com/theme/js/modernizr.js"></script>
</head>

<body>

<!-- Nav Bar -->
<nav>
<div class="top-bar">
<div class="row">
    <div class="large-9 large-centered columns">
	    <h1><a href="http://blog.smallcpp.com">Small Cpp | 勿在浮沙筑高台, 练从难处练, 用从易处用.</a></h1>
    </div>
</div>
</div>

<!-- Show menu items and pages -->
<div class="row">
<div class="large-9 columns">
    <ul class="button-group navigation">

    </ul>
</div>
</div>
</nav>
<!-- End Nav -->


<!-- Main Page Content and Sidebar -->
<div class="row">

    <!-- Main Blog Content -->
    <div class="large-9 columns">
<article>
    <header>
        <h3 class="article-title"><a href="http://blog.smallcpp.com/06-redis-fa-bu-ding-yue-mo-shi.html" rel="bookmark"
        title="Permalink to 06、Redis 发布订阅模式">06、Redis 发布订阅模式</a></h3>
    </header>

<h6 class="subheader" title="2016-03-28T12:40:00+08:00">Mon 28 March 2016
</h6>


    <div class="toc">
<ul>
<li><a href="#mq">MQ 系统</a></li>
<li><a href="#_1">发布订阅模式</a><ul>
<li><a href="#subscribe">subscribe 订阅</a></li>
<li><a href="#unsubscribe">unsubscribe 退订</a></li>
<li><a href="#psubscribe-regex">psubscribe 订阅(RegEx)</a></li>
<li><a href="#punsubscribe">punsubscribe 退订</a></li>
<li><a href="#publish">publish 发布</a></li>
<li><a href="#pubsub">pubsub 自省</a></li>
</ul>
</li>
</ul>
</div>
<h2 id="mq"><a name="user-content-mq" href="#mq" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>MQ 系统</h2>
<p>Redis 提供了两种方式来作消息队列:</p>
<ul>
<li>生产者/消费者模式 模式 (采用 redis 的 list 类型)<ul>
<li>一个或者多个客户端监听消息队列, 一旦消息到达, 消费者马上消费, 谁先抢到算谁的, 如果队列里没有消息, 则消费者继续监听</li>
</ul>
</li>
<li>发布/订阅 模式 (redis 自实现的一种__观察者__模式)<ul>
<li>一个或多个客户端订阅消息频道, 只要发布者发布消息, 所有订阅者都能收到消息</li>
</ul>
</li>
</ul>
<p>简单的说</p>
<ul>
<li>第一种队列方式, 一个任务只会被一个客户端消费</li>
<li>第二种队列方式, 一个任务会被所有客户端消费</li>
</ul>
<h2 id="_1"><a name="user-content-_1" href="#_1" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>发布订阅模式</h2>
<p>这可以说是一种__观察者__模式<br>
发布订阅模式中有两个角色: <strong>发布者</strong> 和 <strong>订阅者</strong><br>
__订阅者__可以订阅一个或多个频道(channel)<br>
__发布者__可以向指定频道发布消息(publish)<br>
所以订阅了该频道的订阅者都将接受到该消息.</p>
<h3 id="subscribe"><a name="user-content-subscribe" href="#subscribe" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>subscribe 订阅</h3>
<ul>
<li>subscribe channel1 channel2 &hellip;<ul>
<li>订阅一个或多个频道</li>
<li>如 subscribe news.it<ul>
<li>使用 subscribe 时的返回值<ul>
<li>1) &ldquo;subscribe&rdquo;<ul>
<li>返回值的类型: 显示订阅成功</li>
</ul>
</li>
<li>2) &ldquo;news.it&rdquo;<ul>
<li>订阅的频道</li>
</ul>
</li>
<li>3) (integer) 1<ul>
<li>目前已订阅的模式的数量(包含自身)</li>
</ul>
</li>
</ul>
</li>
<li>接收到消息时的返回值<ul>
<li>1) &ldquo;message&rdquo;<ul>
<li>返回值的类型: 消息</li>
</ul>
</li>
<li>2) &ldquo;news.it&rdquo;<ul>
<li>消息本身的频道</li>
</ul>
</li>
<li>3) &ldquo;Google buy Motorola&rdquo;<ul>
<li>消息的内容</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="unsubscribe"><a name="user-content-unsubscribe" href="#unsubscribe" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>unsubscribe 退订</h3>
<ul>
<li>unsubscribe channe1 channe2 &hellip;<ul>
<li>退订通过 <strong>subscribe</strong> 订阅的频道<ul>
<li>如果没有频道被指定, 那么客户端通过 <strong>subscribe</strong> 订阅的所有频道都会被退订</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="psubscribe-regex"><a name="user-content-psubscribe-regex" href="#psubscribe-regex" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>psubscribe 订阅(RegEx)</h3>
<ul>
<li>psubscribe mode1 mode2 &hellip;<ul>
<li>订阅一个或多个符合给定模式(RegEx)的频道<ul>
<li>* 匹配所有字符</li>
<li>? 匹配一个任意字符</li>
<li>[] 匹配字符组</li>
<li>\x 匹配转义字符</li>
</ul>
</li>
<li>如 psubscribe news.*<ul>
<li>使用 subscribe 时的返回值<ul>
<li>1) &ldquo;ppsubscribe&rdquo;<ul>
<li>返回值的类型: 显示订阅成功</li>
</ul>
</li>
<li>2) &ldquo;news.*&rdquo;<ul>
<li>订阅的频道模式</li>
</ul>
</li>
<li>3) (integer) 1<ul>
<li>目前已订阅的模式的数量(包含自身)</li>
</ul>
</li>
</ul>
</li>
<li>接收到消息时的返回值<ul>
<li>1) &ldquo;pmessage&rdquo;<ul>
<li>返回值的类型: 消息</li>
</ul>
</li>
<li>2) &ldquo;news.*&rdquo;<ul>
<li>消息匹配的频道模式</li>
</ul>
</li>
<li>3) &ldquo;news.it&rdquo;<ul>
<li>消息本身的频道</li>
</ul>
</li>
<li>4) &ldquo;Google buy Motorola&rdquo;<ul>
<li>消息的内容</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="punsubscribe"><a name="user-content-punsubscribe" href="#punsubscribe" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>punsubscribe 退订</h3>
<ul>
<li>punsubscribe mode1 mode2 &hellip;<ul>
<li>退订通过 <strong>psubscribe</strong> 订阅的频道<ul>
<li>如果没有频道被指定, 那么客户端通过 <strong>psubscribe</strong> 订阅的所有频道都会被退订</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="publish"><a name="user-content-publish" href="#publish" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>publish 发布</h3>
<ul>
<li>publish channel message<ul>
<li>发布消息, 返回接收到这个消息的客户端个数</li>
</ul>
</li>
</ul>
<h3 id="pubsub"><a name="user-content-pubsub" href="#pubsub" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>pubsub 自省</h3>
<p>pubsub 是一个查看订阅与发布系统状态的内省命令，它由数个不同格式的子命令组成.</p>
<p>参考连接: <a href="http://doc.redisfans.com/pub_sub/pubsub.html"><a href="http://doc.redisfans.com/pub_sub/pubsub.html"><a href="http://doc.redisfans.com/pub_sub/pubsub.html">http://doc.redisfans.com/pub_sub/pubsub.html</a></a></a></p>
<p class="subheader">Category: <a href="http://blog.smallcpp.com/category/shen-ru-qian-chu-redis.html">深入浅出 Redis</a>

</p>




</article>
    </div>
    <!-- End Main Content -->

    <!-- Sidebar -->
    <aside class="large-3 columns">
        <h5 class="sidebar-title">Site</h5>
        <ul class="side-nav">
            <li><a href="http://blog.smallcpp.com/archives.html">Archives</a>
            <li><a href="http://blog.smallcpp.com/tags.html">Tags</a>
        </ul>

        <h5 class="sidebar-title">Categories</h5>
        <ul class="side-nav">
            <li><a href="http://blog.smallcpp.com/category/ban-ben-kong-zhi.html">版本控制</a></li>
            <li><a href="http://blog.smallcpp.com/category/c11xin-te-xing.html">C++11新特性</a></li>
            <li><a href="http://blog.smallcpp.com/category/cocos2dyou-xi-kai-fa.html">Cocos2d游戏开发</a></li>
            <li><a href="http://blog.smallcpp.com/category/da-hua-she-ji-mo-shi.html">大话设计模式</a></li>
            <li><a href="http://blog.smallcpp.com/category/da-shu-ju.html">大数据</a></li>
            <li><a href="http://blog.smallcpp.com/category/dai-ma-da-quan.html">代碼大全</a></li>
            <li><a href="http://blog.smallcpp.com/category/golang.html">Golang</a></li>
            <li><a href="http://blog.smallcpp.com/category/hadoop.html">hadoop</a></li>
            <li><a href="http://blog.smallcpp.com/category/hei-ke-ji.html">黑科技</a></li>
            <li><a href="http://blog.smallcpp.com/category/jia-gou-shi-zhi-lu.html">架构师之路</a></li>
            <li><a href="http://blog.smallcpp.com/category/ling-ji-chu-qt-ru-men.html">零基础 QT 入门</a></li>
            <li><a href="http://blog.smallcpp.com/category/linux.html">Linux</a></li>
            <li><a href="http://blog.smallcpp.com/category/luayou-xi-kai-fa.html">Lua游戏开发</a></li>
            <li><a href="http://blog.smallcpp.com/category/pyqt-kai-fa.html">PyQt 开发</a></li>
            <li><a href="http://blog.smallcpp.com/category/python-cong-ru-men-dao-fang-qi.html">Python 从入门到放弃</a></li>
            <li><a href="http://blog.smallcpp.com/category/shen-ru-qian-chu-flask.html">深入浅出 Flask</a></li>
            <li><a href="http://blog.smallcpp.com/category/shen-ru-qian-chu-mongodb.html">深入浅出 Mongodb</a></li>
            <li><a href="http://blog.smallcpp.com/category/shen-ru-qian-chu-redis.html">深入浅出 Redis</a></li>
            <li><a href="http://blog.smallcpp.com/category/za-xiang.html">杂项</a></li>
            <li><a href="http://blog.smallcpp.com/category/zai-xue-java.html">再学 JAVA</a></li>
        </ul>

        <h5 class="sidebar-title">Links</h5>
        <ul class="side-nav">
            <li><a href="http://blog.csdn.net/u010850265">CSDN</a></li>
        </ul>

        <h5 class="sidebar-title">Social</h5>
        <ul class="side-nav">
            <li><a href="http://blog.csdn.net/u010850265">CSDN</a></li>
        </ul>

    </aside> <!-- End Sidebar -->

</div> <!-- End Main Content and Sidebar -->


<!-- Footer -->
<footer class="row">
    <div class="large-12 columns">
        <hr />
        <div class="row">
            <div class="large-6 columns">
              <!--                  <p>Small Cpp | 勿在浮沙筑高台, 练从难处练, 用从易处用. by martin</p> -->
            </div>
            </div>
    </div>
</footer>
</body>
</html>