<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <!-- Site Meta Data -->
  <title>06、Redis 发布订阅模式</title>
  <meta name="description" content="">
  <meta name="author" content="martin">

  <!-- Style Meta Data -->
  <link rel="stylesheet" href="http://blog.smallcpp.cn/theme/css/notebook.css" type="text/css" />
  <link rel="shortcut icon" href="http://blog.smallcpp.cn/theme/images/avatar.png">

  <!-- Feed Meta Data -->
  <link href="http://blog.smallcpp.cn/" type="application/atom+xml" rel="alternate" title="Small Cpp ATOM Feed" />

  <!-- Twitter Feed -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="">
  <meta name="twitter:image" content="http://blog.smallcpp.cn/theme/images/avatar.png">

<meta name="twitter:creator" content="">
<meta name="twitter:url" content="http://blog.smallcpp.cn/06-redis-fa-bu-ding-yue-mo-shi.html">
<meta name="twitter:title" content="Small Cpp ~ 06、Redis 发布订阅模式">
<meta name="twitter:description" content="Redis 提供了两种方式来作消息队列: 生产者/消费者 和 发布/订阅">

<!-- Facebook Meta Data -->
<meta property="og:title" content="Small Cpp ~ 06、Redis 发布订阅模式" />
<meta property="og:description" content="Redis 提供了两种方式来作消息队列: 生产者/消费者 和 发布/订阅" />
<meta property="og:image" content="theme/images/avatar.png" />
</head>

<body>
  <!-- Sidebar -->
  <aside>
    <p><a href="http://blog.smallcpp.cn"><img id="avatar" src="http://blog.smallcpp.cn/theme/images/avatar.png"></a></p>
    <h1>Small Cpp</h1>
    <p>勿在浮沙筑高台, 练从难处练, 用从易处用.</p>
    <hr>
    <h2>Social</h2>
    <ul class="social">
      <a href="http://blog.csdn.net/u010850265">CSDN</a></li>
    </ul>
    <h2>Categories</h2>
    <ul class="navbar">
      <li><a href="http://blog.smallcpp.cn/category/c11.html">C++11</a></li>
      <li><a href="http://blog.smallcpp.cn/category/da-shu-ju.html">大数据</a></li>
      <li><a href="http://blog.smallcpp.cn/category/du-shu-bi-ji.html">读书笔记</a></li>
      <li><a href="http://blog.smallcpp.cn/category/golang.html">Golang</a></li>
      <li><a href="http://blog.smallcpp.cn/category/hei-ke-ji.html">黑科技</a></li>
      <li><a href="http://blog.smallcpp.cn/category/java.html">Java</a></li>
      <li><a href="http://blog.smallcpp.cn/category/linux.html">Linux</a></li>
      <li><a href="http://blog.smallcpp.cn/category/lua.html">Lua</a></li>
      <li><a href="http://blog.smallcpp.cn/category/mongodb.html">Mongodb</a></li>
      <li><a href="http://blog.smallcpp.cn/category/pyqt.html">PyQt</a></li>
      <li><a href="http://blog.smallcpp.cn/category/python.html">Python</a></li>
      <li><a href="http://blog.smallcpp.cn/category/qt.html">QT</a></li>
      <li><a href="http://blog.smallcpp.cn/category/qu-kuai-lian.html">区块链</a></li>
      <li class="active"><a href="http://blog.smallcpp.cn/category/redis.html">Redis</a></li>
      <li><a href="http://blog.smallcpp.cn/category/ruan-jian-she-ji.html">软件设计</a></li>
      <li><a href="http://blog.smallcpp.cn/category/za-xiang.html">杂项</a></li>
    </ul> 
  </aside>

  <!-- Content -->
  <article>
<section id="content">
    <article>
        <header class="post_list">
            <h2 class="post_title"><a href="http://blog.smallcpp.cn/06-redis-fa-bu-ding-yue-mo-shi.html" rel="bookmark" title="Permalink to 06、Redis 发布订阅模式">06、Redis 发布订阅模式</a></h2>
            <span>Par </span>
            <a href="http://blog.smallcpp.cn/author/martin.html">@Martin</a>
            <span> dans </span>
            <span class="post_category"><a href="http://blog.smallcpp.cn/category/redis.html" rel="bookmark" title="Permalink to Redis">[ Redis ]</a></span>
            <span> le </span>
            <span class="post_date">Mon 28 March 2016</span>
            <div></div>
            <div><span>Tags : </span>
            </div>
        </header>
        <div class="entry-content">
            <div class="toc">
<ul>
<li><a href="#mq">MQ 系统</a></li>
<li><a href="#_1">发布订阅模式</a><ul>
<li><a href="#subscribe">subscribe 订阅</a></li>
<li><a href="#unsubscribe">unsubscribe 退订</a></li>
<li><a href="#psubscribe-regex">psubscribe 订阅(RegEx)</a></li>
<li><a href="#punsubscribe">punsubscribe 退订</a></li>
<li><a href="#publish">publish 发布</a></li>
<li><a href="#pubsub">pubsub 自省</a></li>
</ul>
</li>
</ul>
</div>
<h2 id="mq">MQ 系统</h2>
<p>Redis 提供了两种方式来作消息队列:</p>
<ul>
<li>生产者/消费者模式 模式 (采用 redis 的 list 类型)<ul>
<li>一个或者多个客户端监听消息队列, 一旦消息到达, 消费者马上消费, 谁先抢到算谁的, 如果队列里没有消息, 则消费者继续监听</li>
</ul>
</li>
<li>发布/订阅 模式 (redis 自实现的一种__观察者__模式)<ul>
<li>一个或多个客户端订阅消息频道, 只要发布者发布消息, 所有订阅者都能收到消息</li>
</ul>
</li>
</ul>
<p>简单的说</p>
<ul>
<li>第一种队列方式, 一个任务只会被一个客户端消费</li>
<li>第二种队列方式, 一个任务会被所有客户端消费</li>
</ul>
<h2 id="_1">发布订阅模式</h2>
<p>这可以说是一种__观察者__模式<br>
发布订阅模式中有两个角色: <strong>发布者</strong> 和 <strong>订阅者</strong><br>
__订阅者__可以订阅一个或多个频道(channel)<br>
__发布者__可以向指定频道发布消息(publish)<br>
所以订阅了该频道的订阅者都将接受到该消息.</p>
<h3 id="subscribe">subscribe 订阅</h3>
<ul>
<li>subscribe channel1 channel2 &hellip;<ul>
<li>订阅一个或多个频道</li>
<li>如 subscribe news.it<ul>
<li>使用 subscribe 时的返回值<ul>
<li>1) &ldquo;subscribe&rdquo;<ul>
<li>返回值的类型: 显示订阅成功</li>
</ul>
</li>
<li>2) &ldquo;news.it&rdquo;<ul>
<li>订阅的频道</li>
</ul>
</li>
<li>3) (integer) 1<ul>
<li>目前已订阅的模式的数量(包含自身)</li>
</ul>
</li>
</ul>
</li>
<li>接收到消息时的返回值<ul>
<li>1) &ldquo;message&rdquo;<ul>
<li>返回值的类型: 消息</li>
</ul>
</li>
<li>2) &ldquo;news.it&rdquo;<ul>
<li>消息本身的频道</li>
</ul>
</li>
<li>3) &ldquo;Google buy Motorola&rdquo;<ul>
<li>消息的内容</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="unsubscribe">unsubscribe 退订</h3>
<ul>
<li>unsubscribe channe1 channe2 &hellip;<ul>
<li>退订通过 <strong>subscribe</strong> 订阅的频道<ul>
<li>如果没有频道被指定, 那么客户端通过 <strong>subscribe</strong> 订阅的所有频道都会被退订</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="psubscribe-regex">psubscribe 订阅(RegEx)</h3>
<ul>
<li>psubscribe mode1 mode2 &hellip;<ul>
<li>订阅一个或多个符合给定模式(RegEx)的频道<ul>
<li>* 匹配所有字符</li>
<li>? 匹配一个任意字符</li>
<li>[] 匹配字符组</li>
<li>\x 匹配转义字符</li>
</ul>
</li>
<li>如 psubscribe news.*<ul>
<li>使用 subscribe 时的返回值<ul>
<li>1) &ldquo;ppsubscribe&rdquo;<ul>
<li>返回值的类型: 显示订阅成功</li>
</ul>
</li>
<li>2) &ldquo;news.*&rdquo;<ul>
<li>订阅的频道模式</li>
</ul>
</li>
<li>3) (integer) 1<ul>
<li>目前已订阅的模式的数量(包含自身)</li>
</ul>
</li>
</ul>
</li>
<li>接收到消息时的返回值<ul>
<li>1) &ldquo;pmessage&rdquo;<ul>
<li>返回值的类型: 消息</li>
</ul>
</li>
<li>2) &ldquo;news.*&rdquo;<ul>
<li>消息匹配的频道模式</li>
</ul>
</li>
<li>3) &ldquo;news.it&rdquo;<ul>
<li>消息本身的频道</li>
</ul>
</li>
<li>4) &ldquo;Google buy Motorola&rdquo;<ul>
<li>消息的内容</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="punsubscribe">punsubscribe 退订</h3>
<ul>
<li>punsubscribe mode1 mode2 &hellip;<ul>
<li>退订通过 <strong>psubscribe</strong> 订阅的频道<ul>
<li>如果没有频道被指定, 那么客户端通过 <strong>psubscribe</strong> 订阅的所有频道都会被退订</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="publish">publish 发布</h3>
<ul>
<li>publish channel message<ul>
<li>发布消息, 返回接收到这个消息的客户端个数</li>
</ul>
</li>
</ul>
<h3 id="pubsub">pubsub 自省</h3>
<p>pubsub 是一个查看订阅与发布系统状态的内省命令，它由数个不同格式的子命令组成.</p>
<p>参考连接: <a href="http://doc.redisfans.com/pub_sub/pubsub.html">http://doc.redisfans.com/pub_sub/pubsub.html</a></p>
            <div align="center" style="color:#ccc;">☠</div>
        </div>
    </article>
</section>
  </article>


</body>
</html>