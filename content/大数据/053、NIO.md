Title: 053、NIO
Author: Martin
Date: 2016-08-09 15:22
Summary: New I/O

[TOC]

Reference: [Java NIO 系列教程](http://ifeve.com/java-nio-all/)

# 概述
原有的 I/O 流有着太多的软件层次需要提速:

- 小数据块的大量复制
- 在不切换线程上下文的情况下没有办法在多个源之间进行数据的复用
- 无法利用现代 OS 的高性能 I/O 特性 (比如内存和 file 映射)

NIO 主要变化:

- Buffer 类允许在 JVM 和 OS 之间使用很小的内存到内存复制技术来移动数据, 而且不需要过度开销
- 统一的 Channel 类族允许在 Buffer 和文件或 Socket 之间直接交换数据而不需要像原有的 Stream 类那样借助于中间媒介
- NIO 首次提供了文件锁定机制

和 NIO 相关的类都在 `java.nio` 包下


# Buffer
Buffer 有两种一种是 **Heap Buffer**, 另一种是 **Direct Buffer**.

第一种方式是分配 JVM 堆内存, 属于 GC 管辖范围, 由于需要拷贝所以速度相对较慢 (由于 Java 程序运行在 JVM 中, 所以旧的 I/O 流都是需要在 OS 本地内存中转一下);<br>
第二种方式是分配 OS 本地内存, 不属于 GC 管辖范围, 由于不需要内存拷贝所以速度相对较快.

> 由于构造和析构 Direct Buffer 时间成本高, 建议使用**缓冲池**, 参见 netty 的实现.

**References**:<br>
[JAVA NIO 之 Direct Buffer 与 Heap Buffer 的区别？](http://eyesmore.iteye.com/blog/1133335)<br>
[JAVA NIO 内存泄露](http://stevex.blog.51cto.com/4300375/1582209)
