<!DOCTYPE html>
<head>
    <meta charset="utf-8" />
    <!-- Set the viewport width to device width for mobile -->
    <meta name="viewport" content="width=device-width" />

    <title>在 OpenShift 上部署 Django Todolist 应用</title>

    <link rel="stylesheet" href="http://blog.smallcpp.com/theme/css/normalize.css" />
    <link rel="stylesheet" href="http://blog.smallcpp.com/theme/css/foundation.min.css" />
    <link rel="stylesheet" href="http://blog.smallcpp.com/theme/css/style.css" />
    <link rel="stylesheet" href="http://blog.smallcpp.com/theme/css/pygments.css" />
    <link rel="shortcut icon" type="image/x-icon" href="http://blog.smallcpp.com/theme/images/favicon.ico" />
    <script src="http://blog.smallcpp.com/theme/js/modernizr.js"></script>
</head>

<body>

<!-- Nav Bar -->
<nav>
<div class="top-bar">
<div class="row">
    <div class="large-9 large-centered columns">
	    <h1><a href="http://blog.smallcpp.com">Small Cpp | 勿在浮沙筑高台, 练从难处练, 用从易处用.</a></h1>
    </div>
</div>
</div>

<!-- Show menu items and pages -->
<div class="row">
<div class="large-9 columns">
    <ul class="button-group navigation">

    </ul>
</div>
</div>
</nav>
<!-- End Nav -->


<!-- Main Page Content and Sidebar -->
<div class="row">

    <!-- Main Blog Content -->
    <div class="large-9 columns">
<article>
    <header>
        <h3 class="article-title"><a href="http://blog.smallcpp.com/zai-openshift-shang-bu-shu-django-todolist-ying-yong.html" rel="bookmark"
        title="Permalink to 在 OpenShift 上部署 Django Todolist 应用">在 OpenShift 上部署 Django Todolist 应用</a></h3>
    </header>

<h6 class="subheader" title="2016-05-11T10:23:00+08:00">Wed 11 May 2016
</h6>


    <div class="toc">
<ul>
<li><a href="#openshift-django">一、初始化 Openshift Django 应用</a></li>
<li><a href="#django">二、配置默认的 Django</a></li>
<li><a href="#todolist">三、安装 todolist 项目</a></li>
<li><a href="#diy-todolist">四、DIY todolist</a></li>
<li><a href="#_1">五、最后</a></li>
</ul>
</div>
<h1 id="openshift-django"><a name="user-content-openshift-django" href="#openshift-django" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>一、初始化 Openshift Django 应用</h1>
<p>首先去 Openshift 上创建一个 Django 应用, 关于怎么创建 Openshift 应用参考我<a href="http://www.smallcpp.com/wan-jie-ba-tan-xi-qiang-you-ya-de-fan-qiang.html">另一篇笔记</a></p>
<p>我这里创建了一个 <code>todolist-smallcpp.rhcloud.com</code>, 然后, 利用<a href="http://www.smallcpp.com/wan-jie-ba-tan-xi-qiang-you-ya-de-fan-qiang.html">另一篇笔记</a>的知识用 SecureCRT 连上我们的服务器.</p>
<p><strong>补充一下用 putty.exe 连接的方法.</strong></p>
<p>首先, 和<a href="http://www.smallcpp.com/wan-jie-ba-tan-xi-qiang-you-ya-de-fan-qiang.html">另一篇笔记</a>中一样, 通过 <a href="http://www.smallcpp.com/git-jian-ming-shou-ce.html#101-ssh-key">Git 简明手册</a> 拿到了两个密钥文件: id_rsa(私钥) 和 id_rsa.pub(公钥), 将 id_rsa.pub(公钥) 部署到刚创建的 Django 应用上.</p>
<p>putty.exe 不能识别直接从服务器拷贝来的私钥, 需要使用 <code>puttygen.exe</code> 进行格式转换.</p>
<ul>
<li>开 puttygen.exe --> Conversions --> Import Key</li>
<li>选择私钥文件 id_rsa</li>
<li>Save private key -> id_rsa.ppk (保存私钥)</li>
</ul>
<p>最后, 打开 putty.exe</p>
<ul>
<li>Session --> Host Name (填写服务器地址或者域名)</li>
<li>Connection --> SSH --> Auth (点 Browse 选择刚生成的 id_rsa.ppk)</li>
<li>Connection --> Data (填写 Auto-login username)</li>
<li>open</li>
</ul>
<p>成功连接后出现下面这样的提示:</p>
<p><div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span>login as: your login user name
Authenticating with public key <span style="color: #183691">&quot;imported-openssh-key&quot;</span>
...
<span style="color: #A71D7E">[</span>todolist-smallcpp.rhcloud.com your login user name<span style="color: #A71D7E">]</span><span style="color: #183691">\&gt;</span>
</pre></div>

<br></p>
<h1 id="django"><a name="user-content-django" href="#django" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>二、配置默认的 Django</h1>
<p>用 Openshift 创建的 Django 应用默认有一个 <code>Hello World</code> (你懂的&hellip;), 但此时我们直接访问 <a href="https://todolist-smallcpp.rhcloud.com"><a href="https://todolist-smallcpp.rhcloud.com"><a href="https://todolist-smallcpp.rhcloud.com">https://todolist-smallcpp.rhcloud.com</a></a></a> 是会报错的&hellip;需要配置下.</p>
<p>我们先用 git 把 Openshift 上的 Django 项目 pull 回本地 (git 地址在创建应用时网站上会提示), 该项目目录如下:</p>
<p><img alt="" src="http://i66.tinypic.com/zvu6o3.jpg" /></p>
<p>里面有个 <code>Readme.md</code>, 阅读后发现下面这些信息:</p>
<ul>
<li>Django project name 是 myproject (在 wsgi 目录下)</li>
<li>数据库保存在 $OPENSHIFT_DATA_DIR/db.sqlite3 ($OPENSHIFT_DATA_DIR 是一个 Link, 指向 app-root/data)</li>
<li>初次使用, 必须创建/修改 admin 的密码<ul>
<li><code>python $OPENSHIFT_REPO_DIR/wsgi/myproject/manage.py createsuperuser</code> ($OPENSHIFT_REPO_DIR 是一个 Link, 指向 app-root/runtime/repo)</li>
<li>登录地址: <a href="https://todolist-smallcpp.rhcloud.com/admin"><a href="https://todolist-smallcpp.rhcloud.com/admin"><a href="https://todolist-smallcpp.rhcloud.com/admin">https://todolist-smallcpp.rhcloud.com/admin</a></a></a></li>
</ul>
</li>
<li>要注意使用 <code>python $OPENSHIFT_REPO_DIR/wsgi/myproject/manage.py syncdb</code> 同步数据库<ul>
<li>由于 <code>syncdb</code> 的尿性, 如果修改了数据库结构, 需要先执行 <code>rm -f $OPENSHIFT\_DATA\_DIR/db.sqlite3</code></li>
<li>关于 <code>syncdb</code> 的说明参考我另一篇笔记 <code>44. Django migration vs syncdb</code></li>
</ul>
</li>
</ul>
<h1 id="todolist"><a name="user-content-todolist" href="#todolist" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>三、安装 todolist 项目</h1>
<p>todolist 我弄了个<a href="https://github.com/zongxiao/Django-Simple-Todo">开源的源码</a>, clone 到本地, 将目录更名为 <code>todolist</code> 并放到步骤二 pull 回本地的 Django 项目根目录的 <code>wsgi</code> 目录下, 并删除自带的 <code>myproject</code> 目录 (注意, 备份下 <code>myproject</code> 里的 <code>settings.py</code>, 后面有用).</p>
<p><img alt="" src="http://i67.tinypic.com/2ijixar.jpg" /></p>
<p><img alt="" src="http://i63.tinypic.com/24yza51.jpg" /></p>
<p><img alt="" src="http://i67.tinypic.com/j0fyc9.jpg" /></p>
<p>然后有几个关键地方要配置:</p>
<p>首先是 <code>setup.py</code> 文件, 其中有一项 <code>install_requires</code> 很重要, 它表示项目中用到的第三方 python 库, 填在里面的项 push 到 openshift 后, openshift 会自动调用 easy_install 进行安装, 例如:</p>
<p><div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span><span style="color: #333333">install_requires</span> <span style="color: #A71D7E">=</span> [<span style="color: #183691">&#39;Django&lt;=1.8&#39;</span>, <span style="color: #183691">&#39;django-markdown&#39;</span>, <span style="color: #183691">&#39;django-markdown-deux==1.0.5&#39;</span>, <span style="color: #183691">&#39;markdown2==2.3.0&#39;</span>, <span style="color: #183691">&#39;markdown&#39;</span>]
</pre></div>

<br>
然后打开 <code>\todolist\.openshift\action_hooks</code> 目录下的 <code>deploy</code> 文件, 这里面保存的是当 push 到 openshift 后执行的动作, 我们把里面的 <code>myproject</code> 改为 <code>todolist</code>.</p>
<p><div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span><span style="color: #999988; font-style: italic">#!/bin/bash</span>
<span style="color: #999988; font-style: italic"># This deploy hook gets executed after dependencies are resolved and the</span>
<span style="color: #999988; font-style: italic"># build hook has been run but before the application has been started back</span>
<span style="color: #999988; font-style: italic"># up again.  This script gets executed directly, so it could be python, php,</span>
<span style="color: #999988; font-style: italic"># ruby, etc.</span>

<span style="color: #A71D5D">if</span> [ <span style="color: #a61717; background-color: #e3d2d2">!</span> <span style="color: #A71D7E">-</span><span style="color: #333333">f</span> <span style="color: #183691">&quot;$OPENSHIFT_DATA_DIR&quot;</span><span style="color: #333333">secrets</span><span style="color: #A71D7E">.</span><span style="color: #333333">json</span> ]; <span style="color: #333333">then</span>
    <span style="color: #333333">echo</span> <span style="color: #183691">&quot;Generating $OPENSHIFT_DATA_DIR/secrets.json&quot;</span>
    <span style="color: #333333">python</span> <span style="color: #183691">&quot;$OPENSHIFT_REPO_DIR&quot;</span><span style="color: #333333">libs</span><span style="color: #A71D7E">/</span><span style="color: #333333">secrets</span><span style="color: #A71D7E">.</span><span style="color: #333333">py</span> <span style="color: #A71D7E">&gt;</span> <span style="color: #183691">&quot;$OPENSHIFT_DATA_DIR&quot;</span><span style="color: #333333">secrets</span><span style="color: #A71D7E">.</span><span style="color: #333333">json</span>
<span style="color: #333333">fi</span>

<span style="color: #999988; font-style: italic"># GETTING-STARTED: change &#39;todolist&#39; to your project name:</span>
<span style="color: #333333">echo</span> <span style="color: #183691">&quot;Executing &#39;python $OPENSHIFT_REPO_DIR/wsgi/todolist/manage.py migrate --noinput&#39;&quot;</span>
<span style="color: #999988; font-style: italic"># GETTING-STARTED: change &#39;todolist&#39; to your project name:</span>
<span style="color: #333333">python</span> <span style="color: #183691">&quot;$OPENSHIFT_REPO_DIR&quot;</span><span style="color: #333333">wsgi</span><span style="color: #A71D7E">/</span><span style="color: #333333">todolist</span><span style="color: #A71D7E">/</span><span style="color: #333333">manage</span><span style="color: #A71D7E">.</span><span style="color: #333333">py</span> <span style="color: #333333">migrate</span> <span style="color: #A71D7E">--</span><span style="color: #333333">noinput</span>

<span style="color: #999988; font-style: italic"># GETTING-STARTED: change &#39;todolist&#39; to your project name:</span>
<span style="color: #333333">echo</span> <span style="color: #183691">&quot;Executing &#39;python $OPENSHIFT_REPO_DIR/wsgi/todolist/manage.py collectstatic --noinput&#39;&quot;</span>
<span style="color: #999988; font-style: italic"># GETTING-STARTED: change &#39;todolist&#39; to your project name:</span>
<span style="color: #333333">python</span> <span style="color: #183691">&quot;$OPENSHIFT_REPO_DIR&quot;</span><span style="color: #333333">wsgi</span><span style="color: #A71D7E">/</span><span style="color: #333333">todolist</span><span style="color: #A71D7E">/</span><span style="color: #333333">manage</span><span style="color: #A71D7E">.</span><span style="color: #333333">py</span> <span style="color: #333333">collectstatic</span> <span style="color: #A71D7E">--</span><span style="color: #333333">noinput</span>
</pre></div>

<br>
再进入 <code>wsgi</code> 文件夹, 里面有个 <code>application</code> 的文件</p>
<p><div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span><span style="color: #999988; font-style: italic">#!/usr/bin/env python</span>
<span style="color: #A71D5D">import</span> <span style="color: #555555">os</span>
<span style="color: #A71D5D">import</span> <span style="color: #555555">sys</span>
<span style="color: #999988; font-style: italic">## GETTING-STARTED: make sure the next line points to your settings.py:</span>
<span style="color: #333333">os</span><span style="color: #A71D7E">.</span><span style="color: #333333">environ</span>[<span style="color: #183691">&#39;DJANGO_SETTINGS_MODULE&#39;</span>] <span style="color: #A71D7E">=</span> <span style="color: #183691">&#39;openshift.settings&#39;</span>
<span style="color: #999988; font-style: italic">## GETTING-STARTED: make sure the next line points to your django project dir:</span>
<span style="color: #333333">sys</span><span style="color: #A71D7E">.</span><span style="color: #333333">path</span><span style="color: #A71D7E">.</span><span style="color: #333333">append</span>(<span style="color: #333333">os</span><span style="color: #A71D7E">.</span><span style="color: #333333">path</span><span style="color: #A71D7E">.</span><span style="color: #333333">join</span>(<span style="color: #333333">os</span><span style="color: #A71D7E">.</span><span style="color: #333333">environ</span>[<span style="color: #183691">&#39;OPENSHIFT_REPO_DIR&#39;</span>], <span style="color: #183691">&#39;wsgi&#39;</span>, <span style="color: #183691">&#39;openshift&#39;</span>))
<span style="color: #333333">virtenv</span> <span style="color: #A71D7E">=</span> <span style="color: #333333">os</span><span style="color: #A71D7E">.</span><span style="color: #333333">environ</span>[<span style="color: #183691">&#39;APPDIR&#39;</span>] <span style="color: #A71D7E">+</span> <span style="color: #183691">&#39;/virtenv/&#39;</span>
<span style="color: #999988; font-style: italic">## GETTING-STARTED: make sure the next line has the right python version:</span>
<span style="color: #333333">os</span><span style="color: #A71D7E">.</span><span style="color: #333333">environ</span>[<span style="color: #183691">&#39;PYTHON_EGG_CACHE&#39;</span>] <span style="color: #A71D7E">=</span> <span style="color: #333333">os</span><span style="color: #A71D7E">.</span><span style="color: #333333">path</span><span style="color: #A71D7E">.</span><span style="color: #333333">join</span>(<span style="color: #333333">virtenv</span>, <span style="color: #183691">&#39;lib/python2.7/site-packages&#39;</span>)
<span style="color: #333333">virtualenv</span> <span style="color: #A71D7E">=</span> <span style="color: #333333">os</span><span style="color: #A71D7E">.</span><span style="color: #333333">path</span><span style="color: #A71D7E">.</span><span style="color: #333333">join</span>(<span style="color: #333333">virtenv</span>, <span style="color: #183691">&#39;bin/activate_this.py&#39;</span>)
<span style="color: #A71D5D">try</span>:
    <span style="color: #ED6A43">execfile</span>(<span style="color: #333333">virtualenv</span>, <span style="color: #ED6A43">dict</span>(<span style="color: #333333">__file__</span><span style="color: #A71D7E">=</span><span style="color: #333333">virtualenv</span>))
<span style="color: #A71D5D">except</span>:
    <span style="color: #A71D5D">pass</span>
<span style="color: #A71D5D">import</span> <span style="color: #555555">django.core.wsgi</span>
<span style="color: #333333">application</span> <span style="color: #A71D7E">=</span> <span style="color: #333333">django</span><span style="color: #A71D7E">.</span><span style="color: #333333">core</span><span style="color: #A71D7E">.</span><span style="color: #333333">wsgi</span><span style="color: #A71D7E">.</span><span style="color: #333333">get_wsgi_application</span>()
</pre></div>

<br>
注意这两行:</p>
<p><div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span><span style="color: #333333">os</span><span style="color: #A71D7E">.</span><span style="color: #333333">environ</span>[<span style="color: #183691">&#39;DJANGO_SETTINGS_MODULE&#39;</span>] <span style="color: #A71D7E">=</span> <span style="color: #183691">&#39;myproject.settings&#39;</span>
<span style="color: #333333">sys</span><span style="color: #A71D7E">.</span><span style="color: #333333">path</span><span style="color: #A71D7E">.</span><span style="color: #333333">append</span>(<span style="color: #333333">os</span><span style="color: #A71D7E">.</span><span style="color: #333333">path</span><span style="color: #A71D7E">.</span><span style="color: #333333">join</span>(<span style="color: #333333">os</span><span style="color: #A71D7E">.</span><span style="color: #333333">environ</span>[<span style="color: #183691">&#39;OPENSHIFT_REPO_DIR&#39;</span>], <span style="color: #183691">&#39;wsgi&#39;</span>, <span style="color: #183691">&#39;myproject&#39;</span>))
</pre></div>

<br>
改为:</p>
<p><div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span><span style="color: #333333">os</span><span style="color: #A71D7E">.</span><span style="color: #333333">environ</span>[<span style="color: #183691">&#39;DJANGO_SETTINGS_MODULE&#39;</span>] <span style="color: #A71D7E">=</span> <span style="color: #183691">&#39;simple_todo.settings&#39;</span>
<span style="color: #333333">sys</span><span style="color: #A71D7E">.</span><span style="color: #333333">path</span><span style="color: #A71D7E">.</span><span style="color: #333333">append</span>(<span style="color: #333333">os</span><span style="color: #A71D7E">.</span><span style="color: #333333">path</span><span style="color: #A71D7E">.</span><span style="color: #333333">join</span>(<span style="color: #333333">os</span><span style="color: #A71D7E">.</span><span style="color: #333333">environ</span>[<span style="color: #183691">&#39;OPENSHIFT_REPO_DIR&#39;</span>], <span style="color: #183691">&#39;wsgi&#39;</span>, <span style="color: #183691">&#39;todolist&#39;</span>))
</pre></div>

<br>
<strong>注意</strong>, 别改错了,  第一个是 <code>simple_todo.settings</code>, 别改成 <code>todolist.settings</code> 了.</p>
<p>最后, 进入 <code>\todolist\wsgi\todolist\simple_todo</code> 目录, 用之前从 <code>myproject</code> 里备份的 <code>settings.py</code> 替换掉 <code>simple_todo</code> 里的 <code>settings.py</code>.<br>
但要做下修改, 把 <code>settings.py</code> 里的 <code>myproject</code> 替换成 <code>simple_todo</code>, 然后在 <code>INSTALLED_APPS</code> 里添加一项 <code>todo</code>, 再把 <code>Debug</code> 属性改为 <code>False</code> (如果部署到 openshift 后发现有问题, 可以改为 <code>True</code> 后进行调试, 调试完毕再改为 <code>False</code>), 改完后的 <code>settings.py</code> 如下:</p>
<p><div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span><span style="color: #183691">&quot;&quot;&quot;</span>
<span style="color: #183691">Django settings for simple_todo project.</span>

<span style="color: #183691">For more information on this file, see</span>
<span style="color: #183691">https://docs.djangoproject.com/en/1.8/topics/settings/</span>

<span style="color: #183691">For the full list of settings and their values, see</span>
<span style="color: #183691">https://docs.djangoproject.com/en/1.8/ref/settings/</span>
<span style="color: #183691">&quot;&quot;&quot;</span>

<span style="color: #999988; font-style: italic"># Build paths inside the project like this: os.path.join(BASE_DIR, ...)</span>
<span style="color: #A71D5D">import</span> <span style="color: #555555">os</span>
<span style="color: #333333">DJ_PROJECT_DIR</span> <span style="color: #A71D7E">=</span> <span style="color: #333333">os</span><span style="color: #A71D7E">.</span><span style="color: #333333">path</span><span style="color: #A71D7E">.</span><span style="color: #333333">dirname</span>(<span style="color: #333333">__file__</span>)
<span style="color: #333333">BASE_DIR</span> <span style="color: #A71D7E">=</span> <span style="color: #333333">os</span><span style="color: #A71D7E">.</span><span style="color: #333333">path</span><span style="color: #A71D7E">.</span><span style="color: #333333">dirname</span>(<span style="color: #333333">DJ_PROJECT_DIR</span>)
<span style="color: #333333">WSGI_DIR</span> <span style="color: #A71D7E">=</span> <span style="color: #333333">os</span><span style="color: #A71D7E">.</span><span style="color: #333333">path</span><span style="color: #A71D7E">.</span><span style="color: #333333">dirname</span>(<span style="color: #333333">BASE_DIR</span>)
<span style="color: #333333">REPO_DIR</span> <span style="color: #A71D7E">=</span> <span style="color: #333333">os</span><span style="color: #A71D7E">.</span><span style="color: #333333">path</span><span style="color: #A71D7E">.</span><span style="color: #333333">dirname</span>(<span style="color: #333333">WSGI_DIR</span>)
<span style="color: #333333">DATA_DIR</span> <span style="color: #A71D7E">=</span> <span style="color: #333333">os</span><span style="color: #A71D7E">.</span><span style="color: #333333">environ</span><span style="color: #A71D7E">.</span><span style="color: #333333">get</span>(<span style="color: #183691">&#39;OPENSHIFT_DATA_DIR&#39;</span>, <span style="color: #333333">BASE_DIR</span>)

<span style="color: #A71D5D">import</span> <span style="color: #555555">sys</span>
<span style="color: #333333">sys</span><span style="color: #A71D7E">.</span><span style="color: #333333">path</span><span style="color: #A71D7E">.</span><span style="color: #333333">append</span>(<span style="color: #333333">os</span><span style="color: #A71D7E">.</span><span style="color: #333333">path</span><span style="color: #A71D7E">.</span><span style="color: #333333">join</span>(<span style="color: #333333">REPO_DIR</span>, <span style="color: #183691">&#39;libs&#39;</span>))
<span style="color: #A71D5D">import</span> <span style="color: #555555">secrets</span>
<span style="color: #333333">SECRETS</span> <span style="color: #A71D7E">=</span> <span style="color: #333333">secrets</span><span style="color: #A71D7E">.</span><span style="color: #333333">getter</span>(<span style="color: #333333">os</span><span style="color: #A71D7E">.</span><span style="color: #333333">path</span><span style="color: #A71D7E">.</span><span style="color: #333333">join</span>(<span style="color: #333333">DATA_DIR</span>, <span style="color: #183691">&#39;secrets.json&#39;</span>))

<span style="color: #999988; font-style: italic"># Quick-start development settings - unsuitable for production</span>
<span style="color: #999988; font-style: italic"># See https://docs.djangoproject.com/en/1.8/howto/deployment/checklist/</span>

<span style="color: #999988; font-style: italic"># SECURITY WARNING: keep the secret key used in production secret!</span>
<span style="color: #333333">SECRET_KEY</span> <span style="color: #A71D7E">=</span> <span style="color: #333333">SECRETS</span>[<span style="color: #183691">&#39;secret_key&#39;</span>]

<span style="color: #999988; font-style: italic"># SECURITY WARNING: don&#39;t run with debug turned on in production!</span>
<span style="color: #333333">DEBUG</span> <span style="color: #A71D7E">=</span> <span style="color: #ed6a43">False</span>
<span style="color: #333333">TEMPLATE_DEBUG</span> <span style="color: #A71D7E">=</span> <span style="color: #333333">DEBUG</span>

<span style="color: #A71D5D">from</span> <span style="color: #555555">socket</span> <span style="color: #A71D5D">import</span> <span style="color: #333333">gethostname</span>
<span style="color: #333333">ALLOWED_HOSTS</span> <span style="color: #A71D7E">=</span> [
    <span style="color: #333333">gethostname</span>(), <span style="color: #999988; font-style: italic"># For internal OpenShift load balancer security purposes.</span>
    <span style="color: #333333">os</span><span style="color: #A71D7E">.</span><span style="color: #333333">environ</span><span style="color: #A71D7E">.</span><span style="color: #333333">get</span>(<span style="color: #183691">&#39;OPENSHIFT_APP_DNS&#39;</span>), <span style="color: #999988; font-style: italic"># Dynamically map to the OpenShift gear name.</span>
    <span style="color: #999988; font-style: italic">#&#39;example.com&#39;, # First DNS alias (set up in the app)</span>
    <span style="color: #999988; font-style: italic">#&#39;www.example.com&#39;, # Second DNS alias (set up in the app)</span>
]


<span style="color: #999988; font-style: italic"># Application definition</span>

<span style="color: #333333">INSTALLED_APPS</span> <span style="color: #A71D7E">=</span> (
    <span style="color: #183691">&#39;django.contrib.auth&#39;</span>,
    <span style="color: #183691">&#39;django.contrib.contenttypes&#39;</span>,
    <span style="color: #183691">&#39;django.contrib.sessions&#39;</span>,
    <span style="color: #183691">&#39;django.contrib.messages&#39;</span>,
    <span style="color: #183691">&#39;django.contrib.staticfiles&#39;</span>,
    <span style="color: #183691">&#39;todo&#39;</span>,
)

<span style="color: #333333">MIDDLEWARE_CLASSES</span> <span style="color: #A71D7E">=</span> (
    <span style="color: #183691">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span>,
    <span style="color: #183691">&#39;django.middleware.common.CommonMiddleware&#39;</span>,
    <span style="color: #183691">&#39;django.middleware.csrf.CsrfViewMiddleware&#39;</span>,
    <span style="color: #183691">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span>,
    <span style="color: #183691">&#39;django.contrib.auth.middleware.SessionAuthenticationMiddleware&#39;</span>,
    <span style="color: #183691">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span>,
    <span style="color: #183691">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span>,
)

<span style="color: #999988; font-style: italic"># GETTING-STARTED: change &#39;simple_todo&#39; to your project name:</span>
<span style="color: #333333">ROOT_URLCONF</span> <span style="color: #A71D7E">=</span> <span style="color: #183691">&#39;simple_todo.urls&#39;</span>

<span style="color: #333333">TEMPLATES</span> <span style="color: #A71D7E">=</span> [
    {
        <span style="color: #183691">&#39;BACKEND&#39;</span>: <span style="color: #183691">&#39;django.template.backends.django.DjangoTemplates&#39;</span>,
        <span style="color: #183691">&#39;DIRS&#39;</span>: [],
        <span style="color: #183691">&#39;APP_DIRS&#39;</span>: <span style="color: #ed6a43">True</span>,
        <span style="color: #183691">&#39;OPTIONS&#39;</span>: {
            <span style="color: #183691">&#39;context_processors&#39;</span>: [
                <span style="color: #183691">&#39;django.template.context_processors.debug&#39;</span>,
                <span style="color: #183691">&#39;django.template.context_processors.request&#39;</span>,
                <span style="color: #183691">&#39;django.contrib.auth.context_processors.auth&#39;</span>,
                <span style="color: #183691">&#39;django.contrib.messages.context_processors.messages&#39;</span>,
            ],
        },
    },
]

<span style="color: #333333">WSGI_APPLICATION</span> <span style="color: #A71D7E">=</span> <span style="color: #183691">&#39;simple_todo.wsgi.application&#39;</span>

<span style="color: #999988; font-style: italic"># Database</span>
<span style="color: #999988; font-style: italic"># https://docs.djangoproject.com/en/1.8/ref/settings/#databases</span>

<span style="color: #333333">DATABASES</span> <span style="color: #A71D7E">=</span> {
    <span style="color: #183691">&#39;default&#39;</span>: {
        <span style="color: #183691">&#39;ENGINE&#39;</span>: <span style="color: #183691">&#39;django.db.backends.sqlite3&#39;</span>,
        <span style="color: #999988; font-style: italic"># GETTING-STARTED: change &#39;db.sqlite3&#39; to your sqlite3 database:</span>
        <span style="color: #183691">&#39;NAME&#39;</span>: <span style="color: #333333">os</span><span style="color: #A71D7E">.</span><span style="color: #333333">path</span><span style="color: #A71D7E">.</span><span style="color: #333333">join</span>(<span style="color: #333333">DATA_DIR</span>, <span style="color: #183691">&#39;db.sqlite3&#39;</span>),
    }
}

<span style="color: #999988; font-style: italic"># Internationalization</span>
<span style="color: #999988; font-style: italic"># https://docs.djangoproject.com/en/1.8/topics/i18n/</span>

<span style="color: #333333">LANGUAGE_CODE</span> <span style="color: #A71D7E">=</span> <span style="color: #183691">&#39;en-us&#39;</span>

<span style="color: #333333">TIME_ZONE</span> <span style="color: #A71D7E">=</span> <span style="color: #183691">&#39;UTC&#39;</span>

<span style="color: #333333">USE_I18N</span> <span style="color: #A71D7E">=</span> <span style="color: #ed6a43">True</span>

<span style="color: #333333">USE_L10N</span> <span style="color: #A71D7E">=</span> <span style="color: #ed6a43">True</span>

<span style="color: #333333">USE_TZ</span> <span style="color: #A71D7E">=</span> <span style="color: #ed6a43">True</span>


<span style="color: #999988; font-style: italic"># Static files (CSS, JavaScript, Images)</span>
<span style="color: #999988; font-style: italic"># https://docs.djangoproject.com/en/1.8/howto/static-files/</span>

<span style="color: #333333">STATIC_URL</span> <span style="color: #A71D7E">=</span> <span style="color: #183691">&#39;/static/&#39;</span>
<span style="color: #333333">STATIC_ROOT</span> <span style="color: #A71D7E">=</span> <span style="color: #333333">os</span><span style="color: #A71D7E">.</span><span style="color: #333333">path</span><span style="color: #A71D7E">.</span><span style="color: #333333">join</span>(<span style="color: #333333">WSGI_DIR</span>, <span style="color: #183691">&#39;static&#39;</span>)
</pre></div>

<br>
<strong>静态文件的处理</strong></p>
<p>比如 CSS、图片等等, 一般 Django 应用的静态文件的目录是在 settings.py 中配置的, 但是 OpenShift 使用了不一样的方式, 所有的静态文件都将被放置在 <code>wsgi/static</code> 目录下.</p>
<blockquote>
<p>貌似在 openshift 中, css 文件中的 url 属性不生效, 我现在把 css 中的 url 属性都移到 html 标签中嵌套了&hellip;</p>
</blockquote>
<h1 id="diy-todolist"><a name="user-content-diy-todolist" href="#diy-todolist" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>四、DIY todolist</h1>
<p>上面的开源项目基于实现了 todolist 的功能, 不好的是暂时缺少用户管理系统 (所有人访问都是同一个 todolist), 所以准备 DIY 一下, 加一个用户系统.</p>
<h1 id="_1"><a name="user-content-_1" href="#_1" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>五、最后</h1>
<p>重要的事再说一次:</p>
<p>由于 <code>syncdb</code> 的尿性, 如果修改了数据库结构, 需要先执行 <code>rm -f $OPENSHIFT\_DATA\_DIR/db.sqlite3</code>, 再执行次 <code>python $OPENSHIFT_REPO_DIR/wsgi/myproject/manage.py syncdb</code>.</p>
<p>修改后的项目, 我放在 git@oschina 上了, 可以参考参考&hellip;</p>
<p class="subheader">Category: <a href="http://blog.smallcpp.com/category/za-xiang.html">杂项</a>

</p>




</article>
    </div>
    <!-- End Main Content -->

    <!-- Sidebar -->
    <aside class="large-3 columns">
        <h5 class="sidebar-title">Site</h5>
        <ul class="side-nav">
            <li><a href="http://blog.smallcpp.com/archives.html">Archives</a>
            <li><a href="http://blog.smallcpp.com/tags.html">Tags</a>
        </ul>

        <h5 class="sidebar-title">Categories</h5>
        <ul class="side-nav">
            <li><a href="http://blog.smallcpp.com/category/ban-ben-kong-zhi.html">版本控制</a></li>
            <li><a href="http://blog.smallcpp.com/category/c11xin-te-xing.html">C++11新特性</a></li>
            <li><a href="http://blog.smallcpp.com/category/cocos2dyou-xi-kai-fa.html">Cocos2d游戏开发</a></li>
            <li><a href="http://blog.smallcpp.com/category/da-hua-she-ji-mo-shi.html">大话设计模式</a></li>
            <li><a href="http://blog.smallcpp.com/category/da-shu-ju.html">大数据</a></li>
            <li><a href="http://blog.smallcpp.com/category/dai-ma-da-quan.html">代碼大全</a></li>
            <li><a href="http://blog.smallcpp.com/category/golang.html">Golang</a></li>
            <li><a href="http://blog.smallcpp.com/category/hadoop.html">hadoop</a></li>
            <li><a href="http://blog.smallcpp.com/category/hei-ke-ji.html">黑科技</a></li>
            <li><a href="http://blog.smallcpp.com/category/jia-che-bao-dian.html">驾车宝典</a></li>
            <li><a href="http://blog.smallcpp.com/category/jia-gou-shi-zhi-lu.html">架构师之路</a></li>
            <li><a href="http://blog.smallcpp.com/category/ling-ji-chu-qt-ru-men.html">零基础 QT 入门</a></li>
            <li><a href="http://blog.smallcpp.com/category/linux.html">Linux</a></li>
            <li><a href="http://blog.smallcpp.com/category/luayou-xi-kai-fa.html">Lua游戏开发</a></li>
            <li><a href="http://blog.smallcpp.com/category/pyqt-kai-fa.html">PyQt 开发</a></li>
            <li><a href="http://blog.smallcpp.com/category/python-cong-ru-men-dao-fang-qi.html">Python 从入门到放弃</a></li>
            <li><a href="http://blog.smallcpp.com/category/shen-ru-qian-chu-flask.html">深入浅出 Flask</a></li>
            <li><a href="http://blog.smallcpp.com/category/shen-ru-qian-chu-mongodb.html">深入浅出 Mongodb</a></li>
            <li><a href="http://blog.smallcpp.com/category/shen-ru-qian-chu-redis.html">深入浅出 Redis</a></li>
            <li><a href="http://blog.smallcpp.com/category/za-xiang.html">杂项</a></li>
            <li><a href="http://blog.smallcpp.com/category/zai-xue-java.html">再学 JAVA</a></li>
        </ul>

        <h5 class="sidebar-title">Links</h5>
        <ul class="side-nav">
            <li><a href="http://blog.csdn.net/u010850265">CSDN</a></li>
        </ul>

        <h5 class="sidebar-title">Social</h5>
        <ul class="side-nav">
            <li><a href="http://blog.csdn.net/u010850265">CSDN</a></li>
        </ul>

    </aside> <!-- End Sidebar -->

</div> <!-- End Main Content and Sidebar -->


<!-- Footer -->
<footer class="row">
    <div class="large-12 columns">
        <hr />
        <div class="row">
            <div class="large-6 columns">
              <!--                  <p>Small Cpp | 勿在浮沙筑高台, 练从难处练, 用从易处用. by martin</p> -->
            </div>
            </div>
    </div>
</footer>
</body>
</html>