<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <!-- Site Meta Data -->
  <title>44. Django migration vs syncdb</title>
  <meta name="description" content="">
  <meta name="author" content="martin">

  <!-- Style Meta Data -->
  <link rel="stylesheet" href="http://blog.smallcpp.cn/theme/css/notebook.css" type="text/css" />
  <link rel="shortcut icon" href="http://blog.smallcpp.cn/theme/images/avatar.png">

  <!-- Feed Meta Data -->
  <link href="http://blog.smallcpp.cn/" type="application/atom+xml" rel="alternate" title="Small Cpp ATOM Feed" />

  <!-- Twitter Feed -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="">
  <meta name="twitter:image" content="http://blog.smallcpp.cn/theme/images/avatar.png">

<meta name="twitter:creator" content="">
<meta name="twitter:url" content="http://blog.smallcpp.cn/44-django-migration-vs-syncdb.html">
<meta name="twitter:title" content="Small Cpp ~ 44. Django migration vs syncdb">
<meta name="twitter:description" content="migration 是 Django 1.7+ 新特性, Migrations 将模型变更 (添加一个字段, 删除模型等) 映射到数据库 schema.">

<!-- Facebook Meta Data -->
<meta property="og:title" content="Small Cpp ~ 44. Django migration vs syncdb" />
<meta property="og:description" content="migration 是 Django 1.7+ 新特性, Migrations 将模型变更 (添加一个字段, 删除模型等) 映射到数据库 schema." />
<meta property="og:image" content="theme/images/avatar.png" />
</head>

<body>
  <!-- Sidebar -->
  <aside>
    <p><a href="http://blog.smallcpp.cn"><img id="avatar" src="http://blog.smallcpp.cn/theme/images/avatar.png"></a></p>
    <h1>Small Cpp</h1>
    <p>勿在浮沙筑高台, 练从难处练, 用从易处用.</p>
    <hr>
    <h2>Social</h2>
    <ul class="social">
      <a href="http://blog.csdn.net/u010850265">CSDN</a></li>
    </ul>
    <h2>Categories</h2>
    <ul class="navbar">
      <li><a href="http://blog.smallcpp.cn/category/c11.html">C++11</a></li>
      <li><a href="http://blog.smallcpp.cn/category/da-shu-ju.html">大数据</a></li>
      <li><a href="http://blog.smallcpp.cn/category/du-shu-bi-ji.html">读书笔记</a></li>
      <li><a href="http://blog.smallcpp.cn/category/golang.html">Golang</a></li>
      <li><a href="http://blog.smallcpp.cn/category/hei-ke-ji.html">黑科技</a></li>
      <li><a href="http://blog.smallcpp.cn/category/java.html">Java</a></li>
      <li><a href="http://blog.smallcpp.cn/category/linux.html">Linux</a></li>
      <li><a href="http://blog.smallcpp.cn/category/lua.html">Lua</a></li>
      <li><a href="http://blog.smallcpp.cn/category/mongodb.html">Mongodb</a></li>
      <li><a href="http://blog.smallcpp.cn/category/pyqt.html">PyQt</a></li>
      <li class="active"><a href="http://blog.smallcpp.cn/category/python.html">Python</a></li>
      <li><a href="http://blog.smallcpp.cn/category/qt.html">QT</a></li>
      <li><a href="http://blog.smallcpp.cn/category/qu-kuai-lian.html">区块链</a></li>
      <li><a href="http://blog.smallcpp.cn/category/redis.html">Redis</a></li>
      <li><a href="http://blog.smallcpp.cn/category/ruan-jian-she-ji.html">软件设计</a></li>
      <li><a href="http://blog.smallcpp.cn/category/za-xiang.html">杂项</a></li>
    </ul> 
  </aside>

  <!-- Content -->
  <article>
<section id="content">
    <article>
        <header class="post_list">
            <h2 class="post_title"><a href="http://blog.smallcpp.cn/44-django-migration-vs-syncdb.html" rel="bookmark" title="Permalink to 44. Django migration vs syncdb">44. Django migration vs syncdb</a></h2>
            <span>Par </span>
            <a href="http://blog.smallcpp.cn/author/martin.html">@Martin</a>
            <span> dans </span>
            <span class="post_category"><a href="http://blog.smallcpp.cn/category/python.html" rel="bookmark" title="Permalink to Python">[ Python ]</a></span>
            <span> le </span>
            <span class="post_date">Thu 12 May 2016</span>
            <div></div>
            <div><span>Tags : </span>
            </div>
        </header>
        <div class="entry-content">
            <div class="toc">
<ul>
<li><a href="#migrate">一、migrate 概述</a></li>
<li><a href="#migrate_1">二、使用 migrate</a></li>
</ul>
</div>
<h1 id="migrate">一、migrate 概述</h1>
<p>1.7 版本之前, Django 只支持新增模型到数据库中, 通过 syncdb (migrate 的前身) 命令变更或者删除现存的模型是不可能的.</p>
<p>1.7 版本之后, Django 引入了迁移机制:</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span>syncdb is deprecated because of the migration system.

Now you can log your changes using makemigrations. This transforms your model changes into python code to make them deployable to another databases.

After you created the migrations you have to apply them: migrate.

So instead of using syncdb you should use makemigrations and then migrate.
</pre></div>


<p><br></p>
<blockquote>
<p>1.9 版本之后, 彻底移除了 syncdb 命令.</p>
</blockquote>
<p>迁移机制引入两条命令:</p>
<ul>
<li>makemigrations, 根据模型的变更创建新的迁移脚本</li>
<li>migrate, 使迁移生效, 以及未生效时报告它们的状态</li>
</ul>
<p>你应该把迁移作为数据库架构的版本<strong>控制系统</strong>.<br>
<code>makemigrations</code> 负责包装模型变更到独立的迁移文件中, 类似于提交代码<br>
<code>migrate</code> 负责应用到数据库中</p>
<p>迁移文件存放在每个应用程序的一个 <code>migrations</code> 目录中, 被设计成提交, 并作为发布的一部分到代码库中; 你应该在你的开发机器上使用它们, 然后在你的同事的机器上运行相同的迁移脚本, <code>staging machines</code>, 最终应用在生产机器环境.</p>
<p>迁移将在相同的数据集上以相同的方法运行并产生一致的结果, 这意味着你将看到在开发阶段、staging 阶段, 在相同的情况下和生产环境上的表现完全一致.</p>
<h1 id="migrate_1">二、使用 migrate</h1>
<p>migrate 的使用非常简单: 修改 model, 比如增加 field, 然后运行</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span>python manager.py makemigrations
</pre></div>


<p><br>
你的 model 会被扫描, 然后与之前的版本作比较, 在 app 的 migrations 目录下生成本次迁移文件.</p>
<p>我们建议查看一下该迁移文件, 确保没有问题, 然后运行:</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span>python manager.py migrate
</pre></div>


<p><br>
migrate 命令会进行比较, 并应用该迁移.</p>
            <div align="center" style="color:#ccc;">☠</div>
        </div>
    </article>
</section>
  </article>


</body>
</html>