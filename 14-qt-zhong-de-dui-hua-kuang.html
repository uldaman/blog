<!DOCTYPE html>
<head>
    <meta charset="utf-8" />
    <!-- Set the viewport width to device width for mobile -->
    <meta name="viewport" content="width=device-width" />

    <title>14、Qt 中的对话框</title>

    <link rel="stylesheet" href="http://blog.smallcpp.com/theme/css/normalize.css" />
    <link rel="stylesheet" href="http://blog.smallcpp.com/theme/css/foundation.min.css" />
    <link rel="stylesheet" href="http://blog.smallcpp.com/theme/css/style.css" />
    <link rel="stylesheet" href="http://blog.smallcpp.com/theme/css/pygments.css" />
    <link rel="shortcut icon" type="image/x-icon" href="http://blog.smallcpp.com/theme/images/favicon.ico" />
    <script src="http://blog.smallcpp.com/theme/js/modernizr.js"></script>
</head>

<body>

<!-- Nav Bar -->
<nav>
<div class="top-bar">
<div class="row">
    <div class="large-9 large-centered columns">
	    <h1><a href="http://blog.smallcpp.com">Small Cpp | 勿在浮沙筑高台, 练从难处练, 用从易处用.</a></h1>
    </div>
</div>
</div>

<!-- Show menu items and pages -->
<div class="row">
<div class="large-9 columns">
    <ul class="button-group navigation">

    </ul>
</div>
</div>
</nav>
<!-- End Nav -->


<!-- Main Page Content and Sidebar -->
<div class="row">

    <!-- Main Blog Content -->
    <div class="large-9 columns">
<article>
    <header>
        <h3 class="article-title"><a href="http://blog.smallcpp.com/14-qt-zhong-de-dui-hua-kuang.html" rel="bookmark"
        title="Permalink to 14、Qt 中的对话框">14、Qt 中的对话框</a></h3>
    </header>

<h6 class="subheader" title="2015-05-25T14:41:00+08:00">Mon 25 May 2015
</h6>


    <p>Qt 中的对话框通过 QDialog 类来实现, 它是三大父窗口之一(QWidget、QMainWindow、Qdialog), 编程中, 通常我们会设计一个类继承它.</p>
<div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span>&lt;span style=&quot;color: #0000ff&quot;&gt;class&lt;/span&gt; MyDialog : &lt;span style=&quot;color: #0000ff&quot;&gt;public&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt; QDialog {
    Q_OBJECT

&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;public&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;:
}&lt;/span&gt;
</pre></div>


<p>QDialog 是否为顶层窗口是可选的, 如果创建它时, 它的 parent 为 NULL, 则该对话框会作为一个顶层窗口, 否则就会作为其父组件的子对话框;
它们的区别在于顶层窗口在任务栏会有自己的位置，而非顶层窗口则会共享其父组件的位置.</p>
<hr />
<h1 id="_1"><a name="user-content-_1" href="#_1" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>窗口属性</h1>
<p>和 C++ 中一样, QDialog 也有模态与非模态之分, 当我们新建一个窗口后, 通过 exec() 来打开模态窗口, 通过 show() 来打开非模态窗口.</p>
<div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span>&lt;span style=&quot;color: #000000&quot;&gt;MyDialog dialog;
dialog.exec() &lt;/span&gt;&lt;span style=&quot;color: #008000&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000&quot;&gt; dialog.show()&lt;/span&gt;
</pre></div>


<p>除此之外 Qt 中的模态窗口还分为应用程序级别的模态和窗口级别的模态.</p>
<p>应用程序级别的模态是我们理解的 C/C++ 中的模态, 也就是常规理解中的模态, 一旦开启应用程序级别的模态, 那么整个程序都会被阻断, 直到模态窗口返回.</p>
<p>窗口级别的模态只阻塞与其父窗口的交互, 而不会阻塞与应用程序其他窗口的交互(因此, 使用这种模态要求对话框必须有一个父窗口).
这种模态在多窗口模式中很有用, Qt 通过 open() 来打开窗口级别的模态.</p>
<p>举例说明一下可能会更好理解, 假定一个程序通过非模态的方式打开了三个非模态窗口: Dialog1、Dialog2、Dialog3, Dialog1 中又需要再打开一个模态窗口, 如果此时打开的是应用程序级别的模态, 那么Dialog1、Dialog2、Dialog3 都会被阻断, 而如果是窗口级别的模态, 那么只有 Dialog1 会被阻断.</p>
<p>在内部, Qt 其实是通过一个窗口属性 windowModality 来设置窗口是哪种类型的模态.
当窗口被创建出来, <code>windowModality</code>会被设置为 <code>Qt::NonModal</code>, 因此默认都是非模态的, 在调用 <code>QDialog::exec()</code>之后, <code>windowModality</code>会被设为 <code>Qt::ApplicationModal</code>, 当<code>exec()</code>返回后又被设回 <code>Qt::NonModal</code>. (<code>Qt::WindowModal 是窗口级别模态</code>).
当然这只需要了解一下就行, 没必要手动去通过修改 windowModality 来设置窗口.</p>
<hr />
<h1 id="_2"><a name="user-content-_2" href="#_2" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>使用非模态对话框的注意事项(内存泄漏)</h1>
<p>我们已经知道如何打开一个非模态对话框, 我们尝试着编写代码.
假定我们的程序存在一个主窗口 MainWindow, 我们需要在 MainWindow 中打开一个非模态对话框:</p>
<div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span>&lt;span style=&quot;color: #0000ff&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt; MainWindow::open() {
    QDialog dialog(&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;this&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;);
    dialog.setWindowTitle(&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;Hello, dialog!&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;);
    dialog.show();
}&lt;/span&gt;
</pre></div>


<p>尝试着执行程序就会发现, 我们创建的非模态对话框一闪而过, 这是因为 <code>show()</code>函数不会阻塞当前线程, 对话框会显示出来, 然后函数立即返回, 代码继续执行, 而 dialog 是建立在栈上的, <code>show()</code>函数返回, <code>MainWindow::open()</code>函数结束, dialog 超出作用域被析构, 因此对话框消失了.
所以在之前&lt;12、对象模型(moc各parent)&gt;中提到 <strong>大胆在堆上创建对象,</strong> 好, 为了解决这个问题, 我们改成在堆上建立:</p>
<div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span>&lt;span style=&quot;color: #0000ff&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt; MainWindow::open() {
    QDialog &lt;/span&gt;*dialog = &lt;span style=&quot;color: #0000ff&quot;&gt;new&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt; QDialog;
    dialog&lt;/span&gt;-&gt;setWindowTitle(tr(&lt;span style=&quot;color: #800000&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;Hello, dialog!&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;));
    dialog&lt;/span&gt;-&gt;&lt;span style=&quot;color: #000000&quot;&gt;show();
}&lt;/span&gt;
</pre></div>


<p>现在, 我们可以正常打开非模态对话框了.
仔细分析代码就会发现, dialog 使用 new 在堆上分配空间, 却一直没有 delete, 如果我们的程序只有一个 MainWindow 主窗口, 也许这没有问题, 因为当主窗口退出了, 应用程序结束, 系统会回收所有分配给应用程序的空间. 但是, 如果我们的程序不只一个 MainWindow 窗口, 即 MainWindow 关闭时, 应用程序还在运行, 此时就会有内存泄露的问题了.</p>
<p>解决方法很简单, 只需要将 MainWindow 的指针做为 dialog 的父窗口指针即可, 下面两种方式都是可以的(原理参考&lt;12、对象模型(moc各parent)&gt;):</p>
<div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span>&lt;span style=&quot;color: #0000ff&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt; MainWindow::open() {
    QDialog &lt;/span&gt;*dialog = &lt;span style=&quot;color: #0000ff&quot;&gt;new&lt;/span&gt; QDialog(&lt;span style=&quot;color: #0000ff&quot;&gt;this&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;);
    dialog&lt;/span&gt;-&gt;setWindowTitle(&lt;span style=&quot;color: #800000&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;Hello, dialog!&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;);
    dialog&lt;/span&gt;-&gt;&lt;span style=&quot;color: #000000&quot;&gt;show();
}

&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt; MainWindow::open() {
    QDialog &lt;/span&gt;*dialog = &lt;span style=&quot;color: #0000ff&quot;&gt;new&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt; QDialog;
    dialog&lt;/span&gt;-&gt;setWindowTitle(&lt;span style=&quot;color: #800000&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;Hello, dialog!&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;);
    dialog&lt;/span&gt;-&gt;setParent(&lt;span style=&quot;color: #0000ff&quot;&gt;this&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;);
    dialog&lt;/span&gt;-&gt;&lt;span style=&quot;color: #000000&quot;&gt;show();
}&lt;/span&gt;
</pre></div>


<p>但是, 其实这样问题并没有完全解决, 因为只要我们的 MainWindow 不关闭, 那么我们创建的非模态窗口就永远不会被销毁, 我们真实的想法是, 希望 dialog 退出的时候自动销毁对话框.
值得高兴的是, Qt 中是可以这样做的, 我们只需要设置 dialog 的 WindowAttribute 就能达到目的:</p>
<div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span>&lt;span style=&quot;color: #0000ff&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt; MainWindow::open() {
    QDialog &lt;/span&gt;*dialog = &lt;span style=&quot;color: #0000ff&quot;&gt;new&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt; QDialog(&lt;span style=&quot;color: #0000ff&quot;&gt;this&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;);&lt;/span&gt;
    dialog&lt;/span&gt;-&gt;&lt;span style=&quot;color: #000000&quot;&gt;setAttribute(Qt::WA_DeleteOnClose);
    dialog&lt;/span&gt;-&gt;setWindowTitle(&lt;span style=&quot;color: #800000&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;Hello, dialog!&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;);
    dialog&lt;/span&gt;-&gt;&lt;span style=&quot;color: #000000&quot;&gt;show();
}&lt;/span&gt;
</pre></div>


<p>setAttribute(Qt::WA_DeleteOnClose) 这句代码设置了对话框关闭时，自动销毁对话框.
0#=</p>
<p class="subheader">Category: <a href="http://blog.smallcpp.com/category/ling-ji-chu-qt-ru-men.html">零基础 QT 入门</a>

</p>




<!--      -->

    <!-- 多说评论框 start -->
    <h4>Comments !</h4>
    <div class="ds-thread" data-thread-key="14-qt-zhong-de-dui-hua-kuang" data-title="14、Qt 中的对话框" data-url="http://blog.smallcpp.com/14-qt-zhong-de-dui-hua-kuang.html"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
        var duoshuoQuery = {short_name:"smallcpp"};
            (function() {
                var ds = document.createElement('script');
                ds.type = 'text/javascript';ds.async = true;
                ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
                ds.charset = 'UTF-8';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
            })();
    </script>
    <!-- 多说公共JS代码 end -->
</article>
    </div>
    <!-- End Main Content -->

    <!-- Sidebar -->
    <aside class="large-3 columns">
        <h5 class="sidebar-title">Site</h5>
        <ul class="side-nav">
            <li><a href="http://blog.smallcpp.com/archives.html">Archives</a>
            <li><a href="http://blog.smallcpp.com/tags.html">Tags</a>
        </ul>

        <h5 class="sidebar-title">Categories</h5>
        <ul class="side-nav">
            <li><a href="http://blog.smallcpp.com/category/ban-ben-kong-zhi.html">版本控制</a></li>
            <li><a href="http://blog.smallcpp.com/category/c11-xin-te-xing.html">C++11 新特性</a></li>
            <li><a href="http://blog.smallcpp.com/category/cocos2d-you-xi-kai-fa.html">Cocos2d 游戏开发</a></li>
            <li><a href="http://blog.smallcpp.com/category/da-hua-she-ji-mo-shi.html">大话设计模式</a></li>
            <li><a href="http://blog.smallcpp.com/category/da-shu-ju.html">大数据</a></li>
            <li><a href="http://blog.smallcpp.com/category/du-shu-bi-ji.html">读书笔记</a></li>
            <li><a href="http://blog.smallcpp.com/category/golang.html">Golang</a></li>
            <li><a href="http://blog.smallcpp.com/category/hadoop.html">hadoop</a></li>
            <li><a href="http://blog.smallcpp.com/category/hei-ke-ji.html">黑科技</a></li>
            <li><a href="http://blog.smallcpp.com/category/ling-ji-chu-qt-ru-men.html">零基础 QT 入门</a></li>
            <li><a href="http://blog.smallcpp.com/category/linux.html">Linux</a></li>
            <li><a href="http://blog.smallcpp.com/category/lua-you-xi-kai-fa.html">Lua 游戏开发</a></li>
            <li><a href="http://blog.smallcpp.com/category/pyqt-kai-fa.html">PyQt 开发</a></li>
            <li><a href="http://blog.smallcpp.com/category/python-cong-ru-men-dao-fang-qi.html">Python 从入门到放弃</a></li>
            <li><a href="http://blog.smallcpp.com/category/shen-ru-qian-chu-mongodb.html">深入浅出 Mongodb</a></li>
            <li><a href="http://blog.smallcpp.com/category/shen-ru-qian-chu-redis.html">深入浅出 Redis</a></li>
            <li><a href="http://blog.smallcpp.com/category/za-xiang.html">杂项</a></li>
            <li><a href="http://blog.smallcpp.com/category/zai-xue-java.html">再学 JAVA</a></li>
        </ul>

        <h5 class="sidebar-title">Links</h5>
        <ul class="side-nav">
            <li><a href="http://blog.csdn.net/u010850265">CSDN</a></li>
        </ul>

        <h5 class="sidebar-title">Social</h5>
        <ul class="side-nav">
            <li><a href="http://blog.csdn.net/u010850265">CSDN</a></li>
        </ul>

    </aside> <!-- End Sidebar -->

</div> <!-- End Main Content and Sidebar -->


<!-- Footer -->
<footer class="row">
    <div class="large-12 columns">
        <hr />
        <div class="row">
            <div class="large-6 columns">
              <!--                  <p>Small Cpp | 勿在浮沙筑高台, 练从难处练, 用从易处用. by martin</p> -->
            </div>
            </div>
    </div>
</footer>
</body>
</html>