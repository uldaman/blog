<!DOCTYPE html>
<head>
    <meta charset="utf-8" />
    <!-- Set the viewport width to device width for mobile -->
    <meta name="viewport" content="width=device-width" />

    <title>models -- 数据库表、字段及连表</title>

    <link rel="stylesheet" href="http://blog.smallcpp.cn/theme/css/normalize.css" />
    <link rel="stylesheet" href="http://blog.smallcpp.cn/theme/css/foundation.min.css" />
    <link rel="stylesheet" href="http://blog.smallcpp.cn/theme/css/style.css" />
    <link rel="stylesheet" href="http://blog.smallcpp.cn/theme/css/pygments.css" />
    <link rel="shortcut icon" type="image/x-icon" href="http://blog.smallcpp.cn/theme/images/favicon.ico" />
    <script src="http://blog.smallcpp.cn/theme/js/modernizr.js"></script>
</head>

<body>

<!-- Nav Bar -->
<nav>
<div class="top-bar">
<div class="row">
    <div class="large-9 large-centered columns">
	    <h1><a href="http://blog.smallcpp.cn">Small Cpp | 勿在浮沙筑高台, 练从难处练, 用从易处用.</a></h1>
    </div>
</div>
</div>

<!-- Show menu items and pages -->
<div class="row">
<div class="large-9 columns">
    <ul class="button-group navigation">

    </ul>
</div>
</div>
</nav>
<!-- End Nav -->


<!-- Main Page Content and Sidebar -->
<div class="row">

    <!-- Main Blog Content -->
    <div class="large-9 columns">
<article>
    <header>
        <h3 class="article-title"><a href="http://blog.smallcpp.cn/models-shu-ju-ku-biao-zi-duan-ji-lian-biao.html" rel="bookmark"
        title="Permalink to models -- 数据库表、字段及连表">models -- 数据库表、字段及连表</a></h3>
    </header>

<h6 class="subheader" title="2015-09-05T04:30:00+08:00">Sat 05 September 2015
</h6>


    <p>Django 对数据库的操作比较简单, 它已经对数据库进行了封闭, 我们无需去关注数据库的细节(即无需像三层架构那样对数据库进行封闭, Django 已经为我们封装好了).</p>
<p>首先, 打开工作目录下的 settings.py 文件, 修改 DATABASES:</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span>DATABASES = {
    <span style="color: #CD5555">&#39;default&#39;</span>: {
        <span style="color: #CD5555">&#39;ENGINE&#39;</span>:<span style="color: #CD5555">&#39;django.db.backends.mysql&#39;</span>,
        <span style="color: #CD5555">&#39;NAME&#39;</span>:<span style="color: #CD5555">&#39;newdjango&#39;</span>,
        <span style="color: #CD5555">&#39;USER&#39;</span>:<span style="color: #CD5555">&#39;root&#39;</span>,
        <span style="color: #CD5555">&#39;PASSWORD&#39;</span>:<span style="color: #CD5555">&#39;admin&#39;</span>,
        <span style="color: #CD5555">&#39;HOST&#39;</span>:<span style="color: #CD5555">&#39;&#39;</span>,
        <span style="color: #CD5555">&#39;PORT&#39;</span>:<span style="color: #CD5555">&#39;3306&#39;</span>,
    }
}
</pre></div>


<p><br>
上面的 NAME 指的是数据库名, 如下图:</p>
<p><img alt="" src="http://i62.tinypic.com/28vwrvc.jpg"></p>
<p>接下来, 检查下 settings.py 里的 INSTALLED_APPS 是否包含 app:</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span>INSTALLED_APPS = (
    <span style="color: #CD5555">&#39;django.contrib.admin&#39;</span>,
    <span style="color: #CD5555">&#39;django.contrib.auth&#39;</span>,
    <span style="color: #CD5555">&#39;django.contrib.contenttypes&#39;</span>,
    <span style="color: #CD5555">&#39;django.contrib.sessions&#39;</span>,
    <span style="color: #CD5555">&#39;django.contrib.messages&#39;</span>,
    <span style="color: #CD5555">&#39;django.contrib.staticfiles&#39;</span>,
    <span style="color: #CD5555">&#39;web&#39;</span>,
)
</pre></div>


<p><br>
这里是最后一个 &lsquo;web&rsquo;.</p>
<p>Django 不能自动为我们创建数据库, 但是可以为自动创建表, 现在在 models.py 中设置表和字段.</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span><span style="color: #228B22">#-*- coding:utf-8 -*-</span>
<span style="color: #8B008B; font-weight: bold">from</span> <span style="color: #008b45; text-decoration: underline">django.db</span> <span style="color: #8B008B; font-weight: bold">import</span> models

<span style="color: #228B22"># Create your models here.</span>
<span style="color: #8B008B; font-weight: bold">class</span> <span style="color: #008b45; font-weight: bold">UserInfo</span>(models.Model): <span style="color: #228B22"># 表名</span>
    username = models.CharField(max_length=<span style="color: #B452CD">50</span>) <span style="color: #228B22"># 指定字段</span>
    password = models.CharField(max_length=<span style="color: #B452CD">50</span>) <span style="color: #228B22"># 指定字段</span>
</pre></div>


<p><br>
然后, 依次执行命令:</p>
<p><strong>python manage.py makemigrations</strong> &ndash; 基于当前的 Model 创建新的策略文件</p>
<p><strong>python manage.py migrate</strong> &ndash; 让我们在修改 Model 后可以在不影响现有数据的前提下重建表结构</p>
<p>python manage.py syncdb &ndash; migrate 已具有 syncdb 的功能, 所以无需再执行</p>
<p>Python 1.7 以下的版本执行 syncdb.</p>
<p>如果报错: No module named MySQLdb
那么就是没有安装 MySQL Python 模块, 安装下即可, 用 pip 似乎有点问题, 可以下载<a href="http://yunpan.cn/cm69fkFPDirFu">http://yunpan.cn/cm69fkFPDirFu</a> 访问密码 2f0c 安装即可.</p>
<p><strong>常用字段</strong></p>
<table cellpadding="2" width="798" border="0" cellspacing="0" class="table" >
<tbody >
<tr ><td width="200" valign="top" >models.AutoField
</td><td width="596" valign="top" >`自增列
```如果没有的话, 默认会生成一个名称为 ``id` `的列, 如果要显示的自定义一个自增列, 必须将给列设置为主键 primary_key``=``True.``
</td></tr>
<tr ><td width="200" valign="top" >models.CharField
</td><td width="596" valign="top" >字符串字段
必须指定 max_length 参数.
</td></tr>
<tr ><td width="200" valign="top" >models.BooleanField
</td><td width="596" valign="top" >`布尔类型``
`不能为空, Blank``=``True.``
</td></tr>
<tr ><td width="200" valign="top" >models.ComaSeparatedIntegerField
</td><td width="596" valign="top" >用逗号分割的数字
继承 CharField, 所以必须指定 max_lenght 参数.
</td></tr>
<tr ><td width="200" valign="top" >models.DateField
</td><td width="596" valign="top" >日期类型 date
`对于参数, auto_now ``=` `True` `则每次更新都会更新这个时间; auto_now_add 则只是第一次创建添加, 之后的更新不再改变.`
</td></tr>
<tr ><td width="200" valign="top" >models.DateTimeField
</td><td width="596" valign="top" >日期类型 datetime
同DateField的参数.
</td></tr>
<tr ><td width="200" valign="top" >models.Decimal
</td><td width="596" valign="top" >十进制小数类型
必须指定整数位 max_digits 和小数位 decimal_places.
</td></tr>
<tr ><td width="200" valign="top" >models.EmailField
</td><td width="596" valign="top" >字符串类型
对字符串进行正则表达式.
</td></tr>
<tr ><td width="200" valign="top" >models.FloatField
</td><td width="596" valign="top" >`浮点类型 ``double`
</td></tr>
<tr ><td width="200" valign="top" >models.IntegerField
</td><td width="596" valign="top" >整形
</td></tr>
<tr ><td width="200" valign="top" >models.BigIntegerField
</td><td width="596" valign="top" >长整形
</td></tr>
<tr ><td width="200" valign="top" >models.SmallIntegerField
</td><td width="596" valign="top" >数字
`数据库中的字段有: tinyint、smallint、``int``、bigint`
</td></tr>
<tr ><td width="200" valign="top" >models.PositiveIntegerFiel
</td><td width="596" valign="top" >正 Integer
</td></tr>
<tr ><td width="200" valign="top" >models.PositiveSmallIntegerField
</td><td width="596" valign="top" >正 SmallInteger

`integer_field_ranges ``=` `{`

```'IntegerField'``: (``-``2147483648``, ``2147483647``),`

```'BigIntegerField'``: (``-``9223372036854775808``, ``9223372036854775807``),`

```'PositiveSmallIntegerField'``: (``0``, ``32767``),`

```'PositiveIntegerField'``: (``0``, ``2147483647``),`

`'SmallIntegerField'``: (``-``32768``, ``32767``),`

`}`

</td></tr>
<tr ><td width="200" valign="top" >models.IPAddressField
</td><td width="596" valign="top" >字符串类型（ip4正则表达式）
</td></tr>
<tr ><td width="200" valign="top" >models.GenericIPAddressField
</td><td width="596" valign="top" >字符串类型（ip4和ip6是可选的）

`参数 protocol 可以是: both、ipv4、ipv6`

`验证时, 会根据设置报错`

</td></tr>
<tr ><td width="200" valign="top" >models.NullBooleanField
</td><td width="596" valign="top" >允许为空的布尔类型
</td></tr>
<tr >
<td width="200" valign="top" >models.SlugField
</td>
<td width="596" valign="top" >减号、下划线、字母、数字
</td></tr>
<tr >
<td width="200" valign="top" >models.TextField
</td>
<td width="596" valign="top" >`字符串`` ``longtext`
</td></tr>
<tr >
<td width="200" valign="top" >models.TimeField
</td>
<td width="596" valign="top" >时间 HH:MM[:ss[.uuuuuu]]
</td></tr>
<tr >
<td width="200" valign="top" >models.URLField
</td>
<td width="596" valign="top" >字符串, 地址正则表达式
</td></tr>
<tr >
<td width="200" valign="top" >models.BinaryField
</td>
<td width="596" valign="top" >`二进制<br>``23``、models.ImageField
图片<br>``24``、models.FilePathField 文件`
</td></tr></tbody></table>

<p><strong>常用参数</strong></p>
<table cellpadding="2" width="800" border="0" cellspacing="0" class="table" >
<tbody >
<tr >
<td width="200" valign="top" >null = True
</td>
<td width="598" valign="top" >数据库中字段是否可以为空
</td></tr>
<tr >
<td width="200" valign="top" >blank = True
</td>
<td width="598" valign="top" >django 的 Admin 中添加数据时是否可允许空值
</td></tr>
<tr >
<td width="200" valign="top" >primary_key = False
</td>
<td width="598" valign="top" >主键，对AutoField设置主键后，就会代替原来的自增 id 列
</td></tr>
<tr >
<td width="200" valign="top" >auto_now
</td>
<td width="598" valign="top" >自动创建---无论添加或修改，都是当前操作的时间
</td></tr>
<tr >
<td width="200" valign="top" >auto_now_add
</td>
<td width="598" valign="top" >自动创建---永远是创建时的时间
</td></tr>
<tr >
<td width="200" valign="top" >choices
</td>
<td width="598" valign="top" >

GENDER_CHOICE = (
(u'M', u'Male'),
(u'F', u'Female'),
)
gender = models.CharField(max_length=2,choices = GENDER_CHOICE)

</td></tr>
<tr >
<td width="200" valign="top" >max_length
</td>
<td width="598" valign="top" >
</td></tr>
<tr >
<td width="200" valign="top" >default
</td>
<td width="598" valign="top" >默认值
</td></tr>
<tr >
<td width="200" valign="top" >verbose_name
</td>
<td width="598" valign="top" >Admin 中字段的显示名称
</td></tr>
<tr >
<td width="200" valign="top" >name|db_column
</td>
<td width="598" valign="top" >数据库中的字段名称
</td></tr>
<tr >
<td width="200" valign="top" >unique = True
</td>
<td width="598" valign="top" >不允许重复
</td></tr>
<tr >
<td width="200" valign="top" >db_index = True
</td>
<td width="598" valign="top" >数据库索引
</td></tr>
<tr >
<td width="200" valign="top" >editable = True
</td>
<td width="598" valign="top" >在 Admin 里是否可编辑
</td></tr>
<tr >
<td width="200" valign="top" >error_messages = None
</td>
<td width="598" valign="top" >错误提示
</td></tr>
<tr >
<td width="200" valign="top" >auto_created = False
</td>
<td width="598" valign="top" >自动创建
</td></tr>
<tr >
<td width="200" valign="top" >help_text
</td>
<td width="598" valign="top" >在 Admin 中提示帮助信息
</td></tr>
<tr >
<td width="200" valign="top" >validators = []
</td>
<td width="598" valign="top" >
</td></tr>
<tr >
<td width="200" valign="top" >upload-to
</td>
<td width="598" valign="top" >
</td></tr></tbody></table>

<p><strong>外键 &ndash; 多对一</strong></p>
<p>用来形成表表对应, 即让一张表里的某些字段和另一张表里的 ID 字段形成联系.</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span><span style="color: #228B22">#-*- coding:utf-8 -*-</span>
<span style="color: #8B008B; font-weight: bold">from</span> <span style="color: #008b45; text-decoration: underline">django.db</span> <span style="color: #8B008B; font-weight: bold">import</span> models

<span style="color: #8B008B; font-weight: bold">class</span> <span style="color: #008b45; font-weight: bold">UserType</span>(models.Model): <span style="color: #228B22"># 表名</span>
    name = models.CharField(max_length=<span style="color: #B452CD">50</span>) <span style="color: #228B22"># 字段</span>

<span style="color: #228B22"># Create your models here.</span>
<span style="color: #8B008B; font-weight: bold">class</span> <span style="color: #008b45; font-weight: bold">UserInfo</span>(models.Model): <span style="color: #228B22"># 表名</span>
    username = models.CharField(max_length=<span style="color: #B452CD">50</span>) <span style="color: #228B22"># 字段</span>
    password = models.CharField(max_length=<span style="color: #B452CD">50</span>) <span style="color: #228B22"># 字段</span>
    <span style="color: #CD5555">&#39;&#39;&#39;</span>
<span style="color: #CD5555">    建立外键</span>
<span style="color: #CD5555">    字段名称＋ &quot;_id&quot; 做为数据库中的列名称</span>
<span style="color: #CD5555">    这里最终数据库中就是 typeId_id</span>
<span style="color: #CD5555">    &#39;&#39;&#39;</span>
    typeId = models.ForeignKey(<span style="color: #CD5555">&quot;UserType&quot;</span>)
</pre></div>


<p><br></p>
<p><strong>外键 &ndash; 多对多</strong></p>
<p>要实现多对多, 需要再创建一个&rdquo;中间表&rdquo;, 使用 Django, 它会自动帮我们创建.</p>
<div class="codehilite" style="background: #eeeedd"><pre style="line-height: 125%"><span></span><span style="color: #8B008B; font-weight: bold">class</span> <span style="color: #008b45; font-weight: bold">User</span>(models.Model): <span style="color: #228B22"># 表名</span>
    account = models.CharField(max_length=<span style="color: #B452CD">50</span>) <span style="color: #228B22"># 字段</span>

<span style="color: #8B008B; font-weight: bold">class</span> <span style="color: #008b45; font-weight: bold">Group</span>(models.Model): <span style="color: #228B22"># 表名</span>
    groupName = models.CharField(max_length=<span style="color: #B452CD">50</span>) <span style="color: #228B22"># 字段</span>
    user_relation = models.ManyToManyField(<span style="color: #CD5555">&quot;User&quot;</span>) <span style="color: #228B22"># 建立关系, Django 会自动建立中间表</span>
</pre></div>


<p><br>
<img alt="" src="http://i61.tinypic.com/fbe4pw.jpg"></p>
<p class="subheader">Category: <a href="http://blog.smallcpp.cn/category/python.html">Python</a>

</p>




<!--      -->

    <!-- 多说评论框 start -->
    <h4>Comments !</h4>
    <div class="ds-thread" data-thread-key="models-shu-ju-ku-biao-zi-duan-ji-lian-biao" data-title="models -- 数据库表、字段及连表" data-url="http://blog.smallcpp.cn/models-shu-ju-ku-biao-zi-duan-ji-lian-biao.html"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
        var duoshuoQuery = {short_name:"smallcpp"};
            (function() {
                var ds = document.createElement('script');
                ds.type = 'text/javascript';ds.async = true;
                ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
                ds.charset = 'UTF-8';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
            })();
    </script>
    <!-- 多说公共JS代码 end -->
</article>
    </div>
    <!-- End Main Content -->

    <!-- Sidebar -->
    <aside class="large-3 columns">
        <h5 class="sidebar-title">Site</h5>
        <ul class="side-nav">
            <li><a href="http://blog.smallcpp.cn/archives.html">Archives</a>
            <li><a href="http://blog.smallcpp.cn/tags.html">Tags</a>
        </ul>

        <h5 class="sidebar-title">Categories</h5>
        <ul class="side-nav">
            <li><a href="http://blog.smallcpp.cn/category/c11.html">C++11</a></li>
            <li><a href="http://blog.smallcpp.cn/category/cocos2d.html">Cocos2d</a></li>
            <li><a href="http://blog.smallcpp.cn/category/da-hua-she-ji-mo-shi.html">大话设计模式</a></li>
            <li><a href="http://blog.smallcpp.cn/category/da-shu-ju.html">大数据</a></li>
            <li><a href="http://blog.smallcpp.cn/category/da-shu-ju-java-ru-men-dao-jing-tong.html">大数据 Java 入门到精通</a></li>
            <li><a href="http://blog.smallcpp.cn/category/da-shu-ju-linux-ru-men-dao-jing-tong.html">大数据 Linux 入门到精通</a></li>
            <li><a href="http://blog.smallcpp.cn/category/da-shu-ju-mongodb-ru-men-dao-jing-tong.html">大数据 Mongodb 入门到精通</a></li>
            <li><a href="http://blog.smallcpp.cn/category/da-shu-ju-redis-ru-men-dao-jing-tong.html">大数据 Redis 入门到精通</a></li>
            <li><a href="http://blog.smallcpp.cn/category/du-shu-bi-ji.html">读书笔记</a></li>
            <li><a href="http://blog.smallcpp.cn/category/golang.html">Golang</a></li>
            <li><a href="http://blog.smallcpp.cn/category/hei-ke-ji.html">黑科技</a></li>
            <li><a href="http://blog.smallcpp.cn/category/java.html">JAVA</a></li>
            <li><a href="http://blog.smallcpp.cn/category/lua.html">Lua</a></li>
            <li><a href="http://blog.smallcpp.cn/category/pyqt.html">PyQt</a></li>
            <li><a href="http://blog.smallcpp.cn/category/python.html">Python</a></li>
            <li><a href="http://blog.smallcpp.cn/category/qt.html">QT</a></li>
            <li><a href="http://blog.smallcpp.cn/category/ruan-jian-she-ji.html">软件设计</a></li>
            <li><a href="http://blog.smallcpp.cn/category/za-xiang.html">杂项</a></li>
        </ul>

        <h5 class="sidebar-title">Links</h5>
        <ul class="side-nav">
            <li><a href="http://blog.csdn.net/u010850265">CSDN</a></li>
        </ul>

        <h5 class="sidebar-title">Social</h5>
        <ul class="side-nav">
            <li><a href="http://blog.csdn.net/u010850265">CSDN</a></li>
        </ul>

    </aside> <!-- End Sidebar -->

</div> <!-- End Main Content and Sidebar -->


<!-- Footer -->
<footer class="row">
    <div class="large-12 columns">
        <hr />
        <div class="row">
            <div class="large-6 columns">
              <!--                  <p>Small Cpp | 勿在浮沙筑高台, 练从难处练, 用从易处用. by martin</p> -->
            </div>
            </div>
    </div>
</footer>
</body>
</html>