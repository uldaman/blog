<!DOCTYPE html>
<head>
    <meta charset="utf-8" />
    <!-- Set the viewport width to device width for mobile -->
    <meta name="viewport" content="width=device-width" />

    <title>(二)、伪分布式环境搭建</title>

    <link rel="stylesheet" href="http://blog.smallcpp.com/theme/css/normalize.css" />
    <link rel="stylesheet" href="http://blog.smallcpp.com/theme/css/foundation.min.css" />
    <link rel="stylesheet" href="http://blog.smallcpp.com/theme/css/style.css" />
    <link rel="stylesheet" href="http://blog.smallcpp.com/theme/css/pygments.css" />
    <link rel="shortcut icon" type="image/x-icon" href="http://blog.smallcpp.com/theme/images/favicon.ico" />
    <script src="http://blog.smallcpp.com/theme/js/modernizr.js"></script>
</head>

<body>

<!-- Nav Bar -->
<nav>
<div class="top-bar">
<div class="row">
    <div class="large-9 large-centered columns">
	    <h1><a href="http://blog.smallcpp.com">Small Cpp | 勿在浮沙筑高台, 练从难处练, 用从易处用.</a></h1>
    </div>
</div>
</div>

<!-- Show menu items and pages -->
<div class="row">
<div class="large-9 columns">
    <ul class="button-group navigation">

    </ul>
</div>
</div>
</nav>
<!-- End Nav -->


<!-- Main Page Content and Sidebar -->
<div class="row">

    <!-- Main Blog Content -->
    <div class="large-9 columns">
<article>
    <header>
        <h3 class="article-title"><a href="http://blog.smallcpp.com/er-wei-fen-bu-shi-huan-jing-da-jian.html" rel="bookmark"
        title="Permalink to (二)、伪分布式环境搭建">(二)、伪分布式环境搭建</a></h3>
    </header>

<h6 class="subheader" title="2016-01-19T21:01:00+08:00">Tue 19 January 2016
</h6>


    <p>安装好一个 linux. 这里使用 Ubuntu, 参考 <a href="http://www.smallcpp.cn/'%E4%BA%8C%E3%80%81%E4%BD%BF%E7%94%A8-vmware-%E5%AE%89%E8%A3%85-ubuntu'.html">Ubuntu</a></p>
<p>安装好后, 需要做一些设置:</p>
<h1 id="1-ip-hosts"><a name="user-content-1-ip-hosts" href="#1-ip-hosts" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>1. 修改固定 IP 、主机名 及 hosts</h1>
<p><strong>sudo su</strong> 进入 root 权限.</p>
<p><strong>vim /etc/network/interfaces</strong>, 编辑 interfaces 文件.
<div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span>auto lo
iface lo inet loopback

auto eth0
iface eth0 inet static
address 192.168.31.200
netmask 255.255.255.0
gateway 192.168.31.1
</pre></div>

初始文件只有前面两行, 后面的是要添加的内容.</p>
<p><strong>vim /etc/resolv.conf</strong>, 编辑 DNS 解析文件.
<div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span>nameserver 8.8.8.8
nameserver 8.8.4.4
nameserver 192.168.31.1
</pre></div>

改完上面, 如果重启的话, DNS 还是会变为原来的样子, 所以要让其永久改变, 因此, 执行: <br><strong>vim /etc/resolvconf/resolv.conf.d/base</strong>. <br>输入和 DNS 解析文件相同的内容.</p>
<p><strong>vim /etc/hostname</strong>, 修改主机名.</p>
<p><strong>vim /etc/hosts</strong>, 修改 [ip 域名] 对应表.
<div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span>127.0.0.1       localhost
192.168.31.200  itcast01
</pre></div>
</p>
<h1 id="2"><a name="user-content-2" href="#2" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>2. 关闭防火墙</h1>
<p>iptables 是 linux 下一个简单实用的防火墙组件. <br><strong>service iptables status</strong>, 先检查下 iptables 状态, 确认是否安装. <br>如果提示: <strong>iptables：unrecognized service</strong>, 则没有安装 iptables, 那就别管它了; <br>如果 iptables 是安装了的, 那么就要查看它的状态, 及是否自启动等等. <br>暂且略过.</p>
<p>都设置好后, <strong>reboot</strong> 重启系统, <strong>ifconfig</strong> 查看 ip 是否变为我们设置的, hostname 查看主机名.</p>
<h1 id="3-jdk"><a name="user-content-3-jdk" href="#3-jdk" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>3. 安装 JDK</h1>
<p>访问 oracle 官网 : <a href="http://www.oracle.com/index.html"><a href="http://www.oracle.com/index.html"><a href="http://www.oracle.com/index.html">http://www.oracle.com/index.html</a></a></a></p>
<p>我们安装的 jdk 1.7 版本, 因为 1.8 版本太新, 和 hadoop 的兼容性不是很好.</p>
<p><img alt="" src="http://i58.tinypic.com/28gt2bm.jpg" /></p>
<p><img alt="" src="http://i60.tinypic.com/e5lqps.jpg" /></p>
<p><strong>向下翻到最后:</strong></p>
<p><img alt="" src="http://i57.tinypic.com/2w69oat.jpg" /></p>
<p><img alt="" src="http://i58.tinypic.com/ny7bck.jpg" /></p>
<p><img alt="" src="http://i60.tinypic.com/i3w7k2.jpg" /></p>
<p><img alt="" src="http://i59.tinypic.com/111896r.jpg" /></p>
<p>下载好后, 弄到 Ubuntu 里, 解压, 然后在 usr 目录下新建一个 java 目录, 把解压好的文件复制进去.</p>
<p><strong>注意, 在接下来的操作前, 需要将用户切回 itcast (命令: sudo itcat)</strong></p>
<div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span>root@itcast01:/home/itcast# mkdir /usr/java
root@itcast01:/home/itcast# mv 桌面/jdk1.7.0_80/ /usr/java/
vim ~/.bashrc
</pre></div>


<p>打开 VIM 编辑器后, 翻到最后一行, 在后面添加:</p>
<p><div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span>export JAVA_HOME=/usr/java/jdk1.7.0_80
export PATH=$PATH:$JAVA_HOME/bin
</pre></div>

“=”左右两边不能有空格.</p>
<div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span>source ~/.bashrc
</pre></div>


<p>最后刷新下文件.</p>
<p>此时, 不管在哪个目录输入 java 都可以找到执行文件.</p>
<p><img alt="" src="http://i62.tinypic.com/4q5sh2.jpg" /></p>
<h1 id="4-hadoop"><a name="user-content-4-hadoop" href="#4-hadoop" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>4. 下载安装 Hadoop</h1>
<p>访问: <a href="http://archive.apache.org/dist/"><a href="http://archive.apache.org/dist/"><a href="http://archive.apache.org/dist/">http://archive.apache.org/dist/</a></a></a>, apache 的所有项目都在这里.</p>
<p><img alt="" src="http://i61.tinypic.com/29ustjt.jpg" /></p>
<p><img alt="" src="http://i60.tinypic.com/33xy72x.jpg" /></p>
<p><img alt="" src="http://i58.tinypic.com/2nuon4o.jpg" /></p>
<p><img alt="" src="http://i58.tinypic.com/1262ydd.jpg" /></p>
<p>下载完成后, 拖到 Ubuntu 桌面.</p>
<p>**mkdir /usr/itcast, **创建一个文件夹.</p>
<p><strong>cd 桌面</strong>, 进入桌面目录.</p>
<p><strong>tar -zxvf hadoop-2.7.1.tar.gz -C /usr/itcast</strong> (-z 处理gz, x 释放/c 压缩, v 显示详情, f 解压哪个文件)</p>
<p>接下来开始配置 hadoop, 对于 hadoop 2.0+, <strong>有五个文件需要配置:</strong></p>
<p><strong>注意, 在此步操作前, 需要将用户切回 itcast (命令: sudo itcat)</strong></p>
<p><strong>linux 默认权限是 644, 需要修改成 777 (命令: sudo chmod -R 777 /usr/itcast/hadoop-2.7.1/)</strong></p>
<p><strong>Ubuntu 默认并没有安装 ssh 服务, 需要自己手动安装 openssh-server, 判断是否安装 ssh 服务, 可以通过如下命令进行: ssh localhost.</strong></p>
<p><strong>安装命令: sudo apt-get install openssh-server</strong></p>
<hr />
<p><strong>cd /usr/itcast/hadoop-2.7.1/etc/hadoop</strong></p>
<p><strong>vim hadoop-env.sh</strong><br>定位到 26% 左右, 找到
<div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span>export JAVA_HOME=${JAVA_HOME}
</pre></div>

改成
<div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span>export JAVA_HOME=/usr/java/jdk1.7.0_80 (可以在 vim 的命令模式下, 通过 echo $JAVA_HOME 查看路径)
</pre></div>
</p>
<p><strong>vim core-site.xml</strong>
<div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span><span style="color: #000080">&lt;configuration&gt;</span>
        <span style="color: #000080">&lt;property&gt;</span>
        <span style="color: #999988; font-style: italic">&lt;!--用来指定 HDFS 的老大(NameNode)的地址--&gt;</span>
                <span style="color: #000080">&lt;name&gt;</span>fs.defaultFS<span style="color: #000080">&lt;/name&gt;</span>
                <span style="color: #999988; font-style: italic">&lt;!--itcast01 是这台主机名, 要在 hosts 里设置了映射才可以, 不然只能写 ip--&gt;</span>
                <span style="color: #000080">&lt;value&gt;</span>hdfs://itcast01:9000<span style="color: #000080">&lt;/value&gt;</span>
        <span style="color: #000080">&lt;/property&gt;</span>

        <span style="color: #000080">&lt;property&gt;</span>
        <span style="color: #999988; font-style: italic">&lt;!--用来指定 hadoop 运行时产生文件的存放目录--&gt;</span>
                <span style="color: #000080">&lt;name&gt;</span>hadoop.tmp.dir<span style="color: #000080">&lt;/name&gt;</span>
                <span style="color: #000080">&lt;value&gt;</span>/usr/itcast/hadoop-2.7.1/tmp<span style="color: #000080">&lt;/value&gt;</span>
        <span style="color: #000080">&lt;/property&gt;</span>
<span style="color: #000080">&lt;/configuration&gt;</span>
</pre></div>
</p>
<p><strong>vim hdfs-site.xml</strong>
<div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span><span style="color: #000080">&lt;configuration&gt;</span>
        <span style="color: #000080">&lt;property&gt;</span>
        <span style="color: #999988; font-style: italic">&lt;!--指定 HDFS 保存数据的副本个数, 这里因为是伪分布, 所以是 1 份--&gt;</span>
                <span style="color: #000080">&lt;name&gt;</span>dfs.replication<span style="color: #000080">&lt;/name&gt;</span>
                <span style="color: #000080">&lt;value&gt;</span>1<span style="color: #000080">&lt;/value&gt;</span>
        <span style="color: #000080">&lt;/property&gt;</span>
<span style="color: #000080">&lt;/configuration&gt;</span>
</pre></div>
</p>
<p><strong>mv mapred-site.xml.template mapred-site.xml</strong></p>
<p><strong>vim mapred-site.xml</strong>
<div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span><span style="color: #000080">&lt;configuration&gt;</span>
        <span style="color: #000080">&lt;property&gt;</span>
        <span style="color: #999988; font-style: italic">&lt;!--告诉 Hadoop MR 要运行在 yarn 上--&gt;</span>
                <span style="color: #000080">&lt;name&gt;</span>mapreduce.framework.name<span style="color: #000080">&lt;/name&gt;</span>
                <span style="color: #000080">&lt;value&gt;</span>yarn<span style="color: #000080">&lt;/value&gt;</span>
        <span style="color: #000080">&lt;/property&gt;</span>
<span style="color: #000080">&lt;/configuration&gt;</span>
</pre></div>
</p>
<p><strong>vim yarn-site.xml</strong>
<div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span><span style="color: #000080">&lt;configuration&gt;</span>
        <span style="color: #000080">&lt;property&gt;</span>
            <span style="color: #999988; font-style: italic">&lt;!--NodeManager 获取数据的方式是shuffle--&gt;</span>
                <span style="color: #000080">&lt;name&gt;</span>yarn.nodemanager.aux-services<span style="color: #000080">&lt;/name&gt;</span>
                <span style="color: #000080">&lt;value&gt;</span>mapreduce_shuffle<span style="color: #000080">&lt;/value&gt;</span>
        <span style="color: #000080">&lt;/property&gt;</span>
        <span style="color: #000080">&lt;property&gt;</span>
            <span style="color: #999988; font-style: italic">&lt;!--指定 YARN 的老大(ResourceManager 它负责资源的调度、分配)的地址--&gt;</span>
                <span style="color: #000080">&lt;name&gt;</span>yarn.resourcemanager.hostname<span style="color: #000080">&lt;/name&gt;</span>
                <span style="color: #000080">&lt;value&gt;</span>itcast01<span style="color: #000080">&lt;/value&gt;</span>
        <span style="color: #000080">&lt;/property&gt;</span>
<span style="color: #000080">&lt;/configuration&gt;</span>
</pre></div>
</p>
<hr />
<p>这五个文件配置好后, 将下来要**修改环境变量**(确保用户是 itcast), 命令: **vim ~/.bashrc</p>
<div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span>export JAVA_HOME=/usr/java/jdk1.7.0_80
export HADOOP_HOME=/usr/itcast/hadoop-2.7.1
export PATH=$PATH:$JAVA_HOME/bin:$HADOOP_HOME/bin
</pre></div>


<p>然后刷新下 bashrc, 命令: <strong>source ~/.bashrc</strong><br>退回根目录, 测试下 hadoop 命令: hadoop version</p>
<p><strong>初始化 HDFS</strong><br><strong>命令: hdfs namenode -format</strong><br>以前是用 hdfs namenode –format, 格式化后, hadoop 根目录下就多出了 tmp 目录(在上一步第二个配置文件里设置的).</p>
<p><strong>启动 hadoop 服务</strong>
<div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span>cd /usr/itcast/hadoop-2.7.1/sbin/
./start-all.sh
</pre></div>
</p>
<p>输入一堆 yes 和 密码后, 输入 ** jps**, 如果看到 NameNode、ResourceManager、NodeManager、SecondaryNameNode 和 DataNod 六个进程, 就表示启动成功了.</p>
<p>不过有点需要注意, ./start-all.sh 和 hdfs namenode –format 一样, 也是个过时命令, 新的命令是 <strong>start-dfs.sh **和 **start-yarn.sh.</strong></p>
<h1 id="5"><a name="user-content-5" href="#5" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>5. 测试环境</h1>
<p>itcast01:50070 &ndash; hdfs 管理界面</p>
<p>itcast01:8088 &ndash; yarn 管理界面</p>
<p><strong>先测试 hdfs</strong> &ndash; <a href="http://itcast01:50070">http://itcast01:50070</a></p>
<p><img alt="" src="http://i61.tinypic.com/10fcr2s.jpg" /></p>
<p><strong>hadoop fs -put</strong> /home/itcast/桌面/hadoop-2.7.1.tar.gz hdfs://itcast01:9000/hadoop<br>上传文件到 hdfs://itcast01:9000/ 并命名为 hadoop<br>同样功能的命令除了 put 还有 copyFromLocal (过时).</p>
<p><img alt="" src="http://i59.tinypic.com/35b9yqr.jpg" /></p>
<p><img alt="" src="http://i58.tinypic.com/x2ns0h.jpg" /></p>
<p><strong>hadoop fs -get</strong> hdfs://itcast01:9000/hadoop /home/itcast/桌面/hadoop.tar.gz<br>下载文件到桌面, 并命名为 hadoop.tar.gz</p>
<p>执行命令的时候, 可能会出现提示: WARN hdfs.DFSClient: DFSInputStream has been closed already
不用管它, apache 也给出了说明:</p>
<p><img alt="" src="http://i61.tinypic.com/344ql4k.jpg" /></p>
<p><strong>再测试 mr(jar 包) 和 yarn</strong></p>
<p>MR 给出了一些测试 jar, 它们在: /usr/itcast/hadoop-2.7.1/<strong>share</strong>/hadoop/mapreduce 目录下.</p>
<p><strong>cd /usr/itcast/hadoop-2.7.1/share/hadoop/mapreduce</strong></p>
<p>创建一个文件, 输入内容</p>
<p><strong>vim words.txt</strong>
<div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span>hello tom
hello jerry
hello kitty
hello world
hello martin
</pre></div>
</p>
<p>所有的 MR 都是执行在 hdfs 上的, 所以要先上传文件.</p>
<p><strong>hadoop fs -put words.txt hdfs://itcast01:9000/words.txt</strong></p>
<p>/usr/itcast/hadoop-2.7.1/share/hadoop/mapreduce 目录下有个 hadoop-mapreduce-examples-2.7.1.jar, 里面有个 wordcount, 可以用来统计单词个数.
<strong>hadoop jar hadoop-mapreduce-examples-2.7.1.jar wordcount hdfs://itcast01:9000/words.txt hdfs://itcast01:9000/result.txt</strong>
第一个参数是待统计文件, 第二个参数是保存结果的文件路径.</p>
<p>执行完毕后, 查看下 hdfs:</p>
<p><strong>hadoop fs -ls hdfs://itcast01:9000/</strong>
<div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span>Found 4 items
-rw-r--r-- 1 itcast supergroup 210606807 2015-09-19 11:02 hdfs://itcast01:9000/hadoop
drwxr-xr-x - itcast supergroup 0 2015-09-19 11:47 hdfs://itcast01:9000/result.txt
drwx------ - itcast supergroup 0 2015-09-19 11:46 hdfs://itcast01:9000/tmp
-rw-r--r-- 1 itcast supergroup 59 2015-09-19 11:42 hdfs://itcast01:9000/words.txt
</pre></div>
</p>
<p>也可以直接通过 浏览器 查看:</p>
<p><img alt="" src="http://i60.tinypic.com/117qrh2.jpg" /></p>
<p><img alt="" src="http://i59.tinypic.com/15xo7qa.jpg" /></p>
<p>第一个 _SUCCESS 表示执行结果, 这里是成功, 第二个是内容, 把第二个下载下来并打开:
<div class="codehilite" style="background: #F7F7F7"><pre style="line-height: 125%"><span></span>hello 5
jerry 1
kitty 1
martin 1
tom 1
world 1
</pre></div>
</p>
<p class="subheader">Category: <a href="http://blog.smallcpp.com/category/hadoop.html">hadoop</a>

</p>




</article>
    </div>
    <!-- End Main Content -->

    <!-- Sidebar -->
    <aside class="large-3 columns">
        <h5 class="sidebar-title">Site</h5>
        <ul class="side-nav">
            <li><a href="http://blog.smallcpp.com/archives.html">Archives</a>
            <li><a href="http://blog.smallcpp.com/tags.html">Tags</a>
        </ul>

        <h5 class="sidebar-title">Categories</h5>
        <ul class="side-nav">
            <li><a href="http://blog.smallcpp.com/category/ban-ben-kong-zhi.html">版本控制</a></li>
            <li><a href="http://blog.smallcpp.com/category/c11xin-te-xing.html">C++11新特性</a></li>
            <li><a href="http://blog.smallcpp.com/category/cocos2dyou-xi-kai-fa.html">Cocos2d游戏开发</a></li>
            <li><a href="http://blog.smallcpp.com/category/da-hua-she-ji-mo-shi.html">大话设计模式</a></li>
            <li><a href="http://blog.smallcpp.com/category/da-shu-ju.html">大数据</a></li>
            <li><a href="http://blog.smallcpp.com/category/dai-ma-da-quan.html">代碼大全</a></li>
            <li><a href="http://blog.smallcpp.com/category/golang.html">Golang</a></li>
            <li><a href="http://blog.smallcpp.com/category/hadoop.html">hadoop</a></li>
            <li><a href="http://blog.smallcpp.com/category/hei-ke-ji.html">黑科技</a></li>
            <li><a href="http://blog.smallcpp.com/category/jia-che-bao-dian.html">驾车宝典</a></li>
            <li><a href="http://blog.smallcpp.com/category/jia-gou-shi-zhi-lu.html">架构师之路</a></li>
            <li><a href="http://blog.smallcpp.com/category/ling-ji-chu-qt-ru-men.html">零基础 QT 入门</a></li>
            <li><a href="http://blog.smallcpp.com/category/linux.html">Linux</a></li>
            <li><a href="http://blog.smallcpp.com/category/luayou-xi-kai-fa.html">Lua游戏开发</a></li>
            <li><a href="http://blog.smallcpp.com/category/pyqt-kai-fa.html">PyQt 开发</a></li>
            <li><a href="http://blog.smallcpp.com/category/python-cong-ru-men-dao-fang-qi.html">Python 从入门到放弃</a></li>
            <li><a href="http://blog.smallcpp.com/category/shen-ru-qian-chu-flask.html">深入浅出 Flask</a></li>
            <li><a href="http://blog.smallcpp.com/category/shen-ru-qian-chu-mongodb.html">深入浅出 Mongodb</a></li>
            <li><a href="http://blog.smallcpp.com/category/shen-ru-qian-chu-redis.html">深入浅出 Redis</a></li>
            <li><a href="http://blog.smallcpp.com/category/za-xiang.html">杂项</a></li>
            <li><a href="http://blog.smallcpp.com/category/zai-xue-java.html">再学 JAVA</a></li>
        </ul>

        <h5 class="sidebar-title">Links</h5>
        <ul class="side-nav">
            <li><a href="http://blog.csdn.net/u010850265">CSDN</a></li>
        </ul>

        <h5 class="sidebar-title">Social</h5>
        <ul class="side-nav">
            <li><a href="http://blog.csdn.net/u010850265">CSDN</a></li>
        </ul>

    </aside> <!-- End Sidebar -->

</div> <!-- End Main Content and Sidebar -->


<!-- Footer -->
<footer class="row">
    <div class="large-12 columns">
        <hr />
        <div class="row">
            <div class="large-6 columns">
              <!--                  <p>Small Cpp | 勿在浮沙筑高台, 练从难处练, 用从易处用. by martin</p> -->
            </div>
            </div>
    </div>
</footer>
</body>
</html>