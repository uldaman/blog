<!DOCTYPE html>
<head>
    <meta charset="utf-8" />
    <!-- Set the viewport width to device width for mobile -->
    <meta name="viewport" content="width=device-width" />

    <title>023、异常</title>

    <link rel="stylesheet" href="http://z351522453.github.com/theme/css/normalize.css" />
    <link rel="stylesheet" href="http://z351522453.github.com/theme/css/foundation.min.css" />
    <link rel="stylesheet" href="http://z351522453.github.com/theme/css/style.css" />
    <link rel="stylesheet" href="http://z351522453.github.com/theme/css/pygments.css" />	
    <script src="http://z351522453.github.com/theme/js/modernizr.js"></script>
</head>

<body>

<!-- Nav Bar -->
<nav>
<div class="top-bar">
<div class="row">
    <div class="large-9 large-centered columns">
	    <h1><a href="http://z351522453.github.com">Small Cpp | 勿在浮沙筑高台, 练从难处练, 用从易处用.</a></h1>
    </div>
</div>
</div>

<!-- Show menu items and pages -->
<div class="row">
<div class="large-9 columns">
    <ul class="button-group navigation">

    </ul>
</div>
</div>
</nav>
<!-- End Nav -->


<!-- Main Page Content and Sidebar -->
<div class="row">

    <!-- Main Blog Content -->
    <div class="large-9 columns">
<article>
    <header>
        <h3 class="article-title"><a href="http://z351522453.github.com/023-yi-chang.html" rel="bookmark"
        title="Permalink to 023、异常">023、异常</a></h3>
    </header>

<h6 class="subheader" title="2016-03-15T19:05:00+08:00">周二 15 三月 2016
</h6>


    <div class="toc">
<ul>
<li><a href="#_1">异常体系</a></li>
<li><a href="#throwable">Throwable</a></li>
<li><a href="#_2">异常处理</a></li>
<li><a href="#_3">自定义异常</a></li>
<li><a href="#throwthrows">throw、throws</a></li>
<li><a href="#_4">重写的异常</a></li>
</ul>
</div>
<h2 id="_1">异常体系</h2>
<p>Java 把异常当作对象来处理, 并定义一个基类 <strong>java.lang.Throwable</strong> 作为所有异常的超类(父类), 有两个子类 <strong>Error</strong> 和 <strong>Exception</strong>, 分别表示错误和异常.</p>
<ul>
<li>Error 是程序无法处理的错误, 比如 OutOfMemoryError、ThreadDeath 等, 这些异常发生时, JVM 一般会选择线程终止, 所以你最好期望不要出现这类异常.</li>
<li>Exception 是程序本身可以处理的异常, 程序中应当尽可能去处理这些异常.</li>
</ul>
<p>我们主要讨论的是 Exception.</p>
<p>Exception 也分为两大类: <strong>运行异常(RuntimeException)</strong>、<strong>编译异常</strong>.</p>
<p><strong>运行异常</strong> 都是 RuntimeException 类及其子类异常, 如 NullPointerException、IndexOutOfBoundsException 等, 这些异常是不检查异常, 程序中可以选择捕获处理, 也可以不处理, 这些异常一般是由程序逻辑错误引起的, 程序应该从逻辑角度尽可能避免这类异常的发生.</p>
<p><strong>编译异常</strong> 是 RuntimeException 以外的异常, 从程序语法角度讲是必须进行处理的异常, 如果不处理, 程序就不能编译通过, 如 IOException、SQLException 等以及用户自定义的 Exception.</p>
<p><img alt="" src="http://i60.tinypic.com/245dm52.jpg" /></p>
<h2 id="throwable">Throwable</h2>
<p><strong>Throwable 常用方法:</strong></p>
<p>getCause(): 返回抛出异常的原因, 如果 cause 不存在或未知, 则返回 null;</p>
<p>getMessage(): 返回异常的消息信息.</p>
<p>printStackTrace(): 对象的堆栈跟踪输出至错误输出流, 作为字段 System.err 的值.</p>
<p>toString(): 返回此 Throwable 的简短描述</p>
<p><strong>Throwable 构造函数:</strong></p>
<p>Throwable(): 构造一个将 null 作为其详细消息的新 throwable</p>
<p>Throwable(String message): 构造带指定详细消息的新 throwable</p>
<p>Throwable(Throwable cause): 构造一个带指定 cause 和 (cause==null ? null :cause.toString())（它通常包含类和 cause 的详细消息）的详细消息的新 throwable</p>
<p>Throwable(String message, Throwable cause): 构造一个带指定详细消息和 cause 的新 throwable</p>
<h2 id="_2">异常处理</h2>
<p>在 Java 中, 使用 <strong>try-catch</strong> 及 <strong>try-catch-finally</strong> 来捕获并处理异常.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #AA22FF; font-weight: bold">try</span> <span style="color: #666666">{</span>
     <span style="color: #008800; font-style: italic">// 一些会抛出异常的方法</span>
<span style="color: #666666">}</span> <span style="color: #AA22FF; font-weight: bold">catch</span> <span style="color: #666666">(</span>Exception e<span style="color: #666666">)</span> <span style="color: #666666">{</span>
     <span style="color: #008800; font-style: italic">// 该异常处理代码</span>
<span style="color: #666666">}</span>
</pre></div>


<p>例子:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #AA22FF; font-weight: bold">try</span><span style="color: #666666">&lt;</span> <span style="color: #666666">{</span>
    System<span style="color: #666666">.</span><span style="color: #BB4444">out</span><span style="color: #666666">.</span><span style="color: #BB4444">print</span><span style="color: #666666">(</span><span style="color: #BB4444">&quot;请输入你的年龄:&quot;</span><span style="color: #666666">);</span>
    Scanner input <span style="color: #666666">=</span> <span style="color: #AA22FF; font-weight: bold">new</span> Scanner<span style="color: #666666">(</span>System<span style="color: #666666">.</span><span style="color: #BB4444">in</span><span style="color: #666666">);</span>
    <span style="color: #00BB00; font-weight: bold">int</span> age <span style="color: #666666">=</span> input<span style="color: #666666">.</span><span style="color: #BB4444">newtInt</span><span style="color: #666666">();</span>
    System<span style="color: #666666">.</span><span style="color: #BB4444">out</span><span style="color: #666666">.</span><span style="color: #BB4444">println</span><span style="color: #666666">(</span><span style="color: #BB4444">&quot;十年后你&quot;</span> <span style="color: #666666">+</span> <span style="color: #666666">(</span>age <span style="color: #666666">+</span> <span style="color: #666666">10)</span> <span style="color: #666666">+</span> <span style="color: #BB4444">&quot;岁&quot;</span><span style="color: #666666">);</span>
<span style="color: #666666">}</span> <span style="color: #AA22FF; font-weight: bold">catch</span> <span style="color: #666666">(</span>InputMismatchException e<span style="color: #666666">)</span> <span style="color: #666666">{</span>
    System<span style="color: #666666">.</span><span style="color: #BB4444">out</span><span style="color: #666666">.</span><span style="color: #BB4444">println</span><span style="color: #666666">(</span><span style="color: #BB4444">&quot;你应该输入整数!&quot;</span><span style="color: #666666">);</span>
<span style="color: #666666">}</span>
System<span style="color: #666666">.</span><span style="color: #BB4444">out</span><span style="color: #666666">.</span><span style="color: #BB4444">println</span><span style="color: #666666">(</span><span style="color: #BB4444">&quot;程序结束!&quot;</span><span style="color: #666666">);</span>
</pre></div>


<p>如果在 int age = input.newtInt() 这里输入了非整数的其他字符, 如 hello, 那么 System.out.println(&ldquo;十年后你&rdquo; + (age + 10) + &ldquo;岁&rdquo;) 这包就不会被执行, 程序会跳到 catch 语句中, try-catch 执行完后, 后续的语句会继续执行.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #AA22FF; font-weight: bold">try</span> <span style="color: #666666">{</span>
     <span style="color: #008800; font-style: italic">// 一些会抛出异常的方法</span>
<span style="color: #666666">}</span> <span style="color: #AA22FF; font-weight: bold">catch</span> <span style="color: #666666">(</span>Exception e<span style="color: #666666">)</span> <span style="color: #666666">{</span>
     <span style="color: #008800; font-style: italic">// 该异常处理代码</span>
<span style="color: #666666">}</span> <span style="color: #AA22FF; font-weight: bold">finally</span> <span style="color: #666666">{</span>
     <span style="color: #008800; font-style: italic">// 最终要执行的一些代码</span>
<span style="color: #666666">}</span>
</pre></div>


<p><strong>何为 finally?</strong></p>
<p>先看一个没有 finally 的异常处理 try-catch 语句:<br>
假设 count 为要使用到的资源, 并且用完要求释放此资源, 那么我们可以把释放资源的语句放到 try-catch 后执行, 当前的程序不管是在执行完 try 语句块还是 catch 语句块, 都会顺序执行到下面释放资源的语句.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #00BB00; font-weight: bold">int</span> count <span style="color: #666666">=</span> <span style="color: #666666">0;</span> <span style="color: #008800; font-style: italic">// 初始化资源</span>
<span style="color: #AA22FF; font-weight: bold">try</span> <span style="color: #666666">{</span>
    count<span style="color: #666666">++;</span>
    <span style="color: #008800; font-style: italic">// 一些会抛出异常的方法</span>
<span style="color: #666666">}</span> <span style="color: #AA22FF; font-weight: bold">catch</span> <span style="color: #666666">(</span>Exception e<span style="color: #666666">)</span> <span style="color: #666666">{</span>
    <span style="color: #008800; font-style: italic">// 异常处理</span>
<span style="color: #666666">}</span>
count <span style="color: #666666">=</span> <span style="color: #666666">0;</span> <span style="color: #008800; font-style: italic">//释放资源</span>
</pre></div>


<p>这段代码是没问题的, 但是, 如果在 try 或 catch 中有 return 语句, 那么在每条 return 语句之前, 都要先执行释放资源的语句, 这样, 就需要在每一个可能返回的地方, 考虑如何释放资源, 最终将导致代码的复杂和冗余.<br>
所以, 需要 finally 语句, 把资源释放或状态还原的代码放到 finally 块中, finally 语句是在 return 语句执行之后、return 返回之前(返回到调用函数之前)执行, 此时, 就不需要再考虑各种复杂的资源释放情况.</p>
<blockquote>
<p>system.exit() 是唯一可以中断 finally 的命令.</p>
</blockquote>
<h2 id="_3">自定义异常</h2>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #AA22FF; font-weight: bold">class</span> <span style="color: #0000FF">自定义异常类</span> <span style="color: #AA22FF; font-weight: bold">extends</span> 异常类型 <span style="color: #666666">{</span>

    <span style="color: #008800; font-style: italic">// 构造函数</span>
    <span style="color: #AA22FF; font-weight: bold">public</span> <span style="color: #00A000">自定义异常类</span><span style="color: #666666">(</span>String info<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #AA22FF; font-weight: bold">super</span><span style="color: #666666">(</span>info<span style="color: #666666">);</span> <span style="color: #008800; font-style: italic">// 调用 父类(String message): 构造带指定详细消息的新异常</span>
    <span style="color: #666666">}</span>
<span style="color: #666666">}</span>
</pre></div>


<h2 id="throwthrows">throw、throws</h2>
<p>throw 关键字是用于__方法体内部__, 用来抛出一个 Throwable 类型的异常;</p>
<ul>
<li>如果抛出了检查异常, 则还应该在方法头部声明方法可能抛出的异常类型, 该方法的调用者也必须检查处理抛出的异常</li>
<li>如果抛出的是 Error 或 RuntimeException, 则该方法的调用者可选择处理该异常</li>
<li>如果所有方法都层层上抛获取的异常, 最终 JVM 会进行处理, 处理也很简单, 就是打印异常消息和堆栈信息</li>
</ul>
<p>throws 关键字用于__方法声明部分__, 用来声明方法可能会抛出某些异常, 仅当抛出了__检查异常__, 该方法的调用者才必须处理或者重新抛出该异常, 当方法的调用者无力处理该异常的时候, 应该继续抛出, 而不是囫囵吞枣, 一般在 catch 块中打印一下堆栈信息做个勉强处理.</p>
<p>下面给出一个简单例子, 看看如何 使用这两个关键字:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #AA22FF; font-weight: bold">public</span> <span style="color: #AA22FF; font-weight: bold">static</span> <span style="color: #00BB00; font-weight: bold">void</span> <span style="color: #00A000">test</span><span style="color: #666666">()</span> <span style="color: #AA22FF; font-weight: bold">throws</span> Exception <span style="color: #666666">{</span>
     <span style="color: #008800; font-style: italic">// 抛出一个检查异常</span>
     <span style="color: #AA22FF; font-weight: bold">throw</span> <span style="color: #AA22FF; font-weight: bold">new</span> Exception<span style="color: #666666">(</span><span style="color: #BB4444">&quot;方法 test 中的Exception&quot;</span><span style="color: #666666">);</span>
<span style="color: #666666">}</span>
</pre></div>


<p>之前说到: 如果抛出了检查异常, 则该方法的调用者也必须检查处理抛出的异常;<br>
所以要调用 test() 的方法就必须处理 test() 抛出的异常或者添加 throws 声明将将异常继续上抛.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008800; font-style: italic">// 处理 test() 抛出的异常</span>
<span style="color: #AA22FF; font-weight: bold">public</span> <span style="color: #00BB00; font-weight: bold">void</span> <span style="color: #00A000">compute_1</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
    <span style="color: #AA22FF; font-weight: bold">try</span> <span style="color: #666666">{</span>
        test<span style="color: #666666">()</span>
    <span style="color: #666666">}</span> <span style="color: #AA22FF; font-weight: bold">catch</span> <span style="color: #666666">(</span>Exception e<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        System<span style="color: #666666">.</span><span style="color: #BB4444">out</span><span style="color: #666666">.</span><span style="color: #BB4444">println</span><span style="color: #666666">(</span><span style="color: #BB4444">&quot;e.getMessage()&quot;</span><span style="color: #666666">);</span>
    <span style="color: #666666">}</span>
<span style="color: #666666">}</span>

<span style="color: #008800; font-style: italic">// 或者添加 throws 声明, 将异常上抛</span>
<span style="color: #AA22FF; font-weight: bold">public</span> <span style="color: #00BB00; font-weight: bold">void</span> <span style="color: #00A000">compute_2</span><span style="color: #666666">()</span> <span style="color: #AA22FF; font-weight: bold">throws</span> Exception <span style="color: #666666">{</span>
    test<span style="color: #666666">()</span>
<span style="color: #666666">}</span>
</pre></div>


<h2 id="_4">重写的异常</h2>
<p>重写方法, 如果也要抛异常, 则只能抛出被覆盖的方法中同样的异常或者异常的子类.</p>
<p class="subheader">Category: <a href="http://z351522453.github.com/category/da-shu-ju.html">大数据</a>

</p>




</article>
    </div>
    <!-- End Main Content -->

    <!-- Sidebar -->
    <aside class="large-3 columns">
        <h5 class="sidebar-title">Site</h5>
        <ul class="side-nav">
            <li><a href="http://z351522453.github.com/archives.html">Archives</a>
            <li><a href="http://z351522453.github.com/tags.html">Tags</a>
        </ul>

		
        <h5 class="sidebar-title">Categories</h5>
        <ul class="side-nav">
            <li><a href="http://z351522453.github.com/category/ban-ben-kong-zhi.html">版本控制</a></li>
            <li><a href="http://z351522453.github.com/category/c11xin-te-xing.html">C++11新特性</a></li>
            <li><a href="http://z351522453.github.com/category/cocos2dyou-xi-kai-fa.html">Cocos2d游戏开发</a></li>
            <li><a href="http://z351522453.github.com/category/da-hua-she-ji-mo-shi.html">大话设计模式</a></li>
            <li><a href="http://z351522453.github.com/category/da-shu-ju.html">大数据</a></li>
            <li><a href="http://z351522453.github.com/category/dai-ma-da-quan.html">代碼大全</a></li>
            <li><a href="http://z351522453.github.com/category/golang.html">Golang</a></li>
            <li><a href="http://z351522453.github.com/category/hadoop.html">hadoop</a></li>
            <li><a href="http://z351522453.github.com/category/hei-ke-ji.html">黑科技</a></li>
            <li><a href="http://z351522453.github.com/category/jia-che-bao-dian.html">驾车宝典</a></li>
            <li><a href="http://z351522453.github.com/category/jia-gou-shi-zhi-lu.html">架构师之路</a></li>
            <li><a href="http://z351522453.github.com/category/ling-ji-chu-qt-ru-men.html">零基础 QT 入门</a></li>
            <li><a href="http://z351522453.github.com/category/linux.html">Linux</a></li>
            <li><a href="http://z351522453.github.com/category/luayou-xi-kai-fa.html">Lua游戏开发</a></li>
            <li><a href="http://z351522453.github.com/category/pyqt-kai-fa.html">PyQt 开发</a></li>
            <li><a href="http://z351522453.github.com/category/python-cong-ru-men-dao-fang-qi.html">Python 从入门到放弃</a></li>
            <li><a href="http://z351522453.github.com/category/shen-ru-qian-chu-flask.html">深入浅出 Flask</a></li>
            <li><a href="http://z351522453.github.com/category/shen-ru-qian-chu-mongodb.html">深入浅出 Mongodb</a></li>
            <li><a href="http://z351522453.github.com/category/shen-ru-qian-chu-redis.html">深入浅出 Redis</a></li>
            <li><a href="http://z351522453.github.com/category/za-xiang.html">杂项</a></li>
            <li><a href="http://z351522453.github.com/category/zai-xue-java.html">再学 JAVA</a></li>
   
        </ul>

        <h5 class="sidebar-title">Links</h5>
        <ul class="side-nav">
            <li><a href="http://blog.csdn.net/u010850265">CSDN</a></li>
        </ul>
		
        <h5 class="sidebar-title">Social</h5>
        <ul class="side-nav">
            <li><a href="http://blog.csdn.net/u010850265">CSDN</a></li>
        </ul>

    </aside> <!-- End Sidebar -->

</div> <!-- End Main Content and Sidebar -->


<!-- Footer -->
<footer class="row">
    <div class="large-12 columns">
        <hr />
        <div class="row">
            <div class="large-6 columns">
              <!--                  <p>Small Cpp | 勿在浮沙筑高台, 练从难处练, 用从易处用. by martin</p> -->
            </div>
            </div>
    </div>
</footer>
</body>
</html>