<!DOCTYPE html>
<head>
    <meta charset="utf-8" />
    <!-- Set the viewport width to device width for mobile -->
    <meta name="viewport" content="width=device-width" />

    <title>05、PyQt 的信号槽</title>

    <link rel="stylesheet" href="http://blog.smallcpp.cn/theme/css/normalize.css" />
    <link rel="stylesheet" href="http://blog.smallcpp.cn/theme/css/foundation.min.css" />
    <link rel="stylesheet" href="http://blog.smallcpp.cn/theme/css/style.css" />
    <link rel="stylesheet" href="http://blog.smallcpp.cn/theme/css/pygments.css" />
    <link rel="shortcut icon" type="image/x-icon" href="http://blog.smallcpp.cn/theme/images/favicon.ico" />
    <script src="http://blog.smallcpp.cn/theme/js/modernizr.js"></script>
</head>

<body>

<!-- Nav Bar -->
<nav>
<div class="top-bar">
<div class="row">
    <div class="large-9 large-centered columns">
	    <h1><a href="http://blog.smallcpp.cn">Small Cpp | 勿在浮沙筑高台, 练从难处练, 用从易处用.</a></h1>
    </div>
</div>
</div>

<!-- Show menu items and pages -->
<div class="row">
<div class="large-9 columns">
    <ul class="button-group navigation">

    </ul>
</div>
</div>
</nav>
<!-- End Nav -->


<!-- Main Page Content and Sidebar -->
<div class="row">

    <!-- Main Blog Content -->
    <div class="large-9 columns">
<article>
    <header>
        <h3 class="article-title"><a href="http://blog.smallcpp.cn/05-pyqt-de-xin-hao-cao.html" rel="bookmark"
        title="Permalink to 05、PyQt 的信号槽">05、PyQt 的信号槽</a></h3>
    </header>

<h6 class="subheader" title="2016-05-12T00:29:00+08:00">Thu 12 May 2016
</h6>


    <p>关于 Qt 信号槽的基础知识参考我另一个系列笔记: <a href="http://www.smallcpp.cn/category/ling-ji-chu-qtru-men2.html">零基础QT入门</a></p>
<p>[TOC]</p>
<h1>使用 Qt 设计师生成信号槽</h1>
<p>首先, 在 <code>Qt 设计师</code> 上的信号槽是可以被 Eric 转换的, 也就是说, 以前那种直接在 <code>Qt 设计师</code> 上拖拽来编辑信号槽的方式是被兼容的.</p>
<p><img alt="" src="http://i67.tinypic.com/2f06h69.jpg"></p>
<p>保存好后, 到 eric 中编译窗体, 就会发现 <code>Ui_first_window.py</code> 文件被修改了, 添加了一行信号槽关联代码:</p>
<p><img alt="" src="http://i68.tinypic.com/264qjw0.jpg"></p>
<h1>使用 Eric 生成信号槽</h1>
<p>然后, eric 强大的地方在于, 它能够快捷的从 <code>Ui_first_window.py</code> 生成信号槽, 而不需要事先在 <code>Qt 设计师</code> 中拖放, 我们先在刚才的窗体上添加一个新按钮, 记住它的 <strong>objectName</strong> 为 pushButton_2, 然后回到 eric 中, 在 <code>first_window.ui</code> 上右键, 选择 "生成对话框代码", 我们可以看到 "窗体代码产生器" 上已经发生了一些变化:</p>
<p><img alt="" src="http://i64.tinypic.com/2gvr5o4.jpg"></p>
<p>红框部分就是 pushButton_2 按钮的信号, 我们勾选 <code>on_pushButton_2_clicked()</code> 后点击保存, 发现 <code>first_window.py</code> 文件已被更改, 多了一个槽处理函数:</p>
<div class="highlight"><pre><span></span><span class="nd">@pyqtSignature</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">on_pushButton_2_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Slot documentation goes here.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: not implemented yet</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</pre></div>


<p><br>
这个槽函数会被关联到 pushButton_2 按钮的 clicked 信号, 我们翻阅代码发现并没有找到 Qt 的信号槽关联函数 (connect), 其实它是通过下面这句代码来实现的:</p>
<p><img alt="" src="http://i66.tinypic.com/2v8pmc0.jpg"></p>
<p>这可以说是 eric 给我们定义好的 "轮子" 了.</p>
<blockquote>
<p>这里仅补充一下<strong>信号槽编程</strong>与<strong>事件编程</strong>的差异, 对于从 MFC 转到 Qt 来的我而言, on_pushButton_2_clicked() 函数类似 MFC 中的按钮点击事件, 其实并不然, 底层实现先抛开不说, 就使用上而言, MFC 按钮点击事件需要先定义一个事件 (一串数字), 而信号槽则不需要, 只要两个函数符合条件, 就能通过 Qt 的 connect 函数把它们关联起来.</p>
</blockquote>
<h1>自定义信号槽</h1>
<p>记得以前在学 Qt 时, 连接信号槽的那个函数难记死了...而在 PyQt 中, 连接一个信号槽, 简直简单到爆...并且 PyQt4 allows any Python callable to be used as a slot, not just Qt slots.</p>
<p>参考官方文档: <a href="http://pyqt.sourceforge.net/Docs/PyQt4/new_style_signals_slots.html#PyQt4.QtCore.pyqtSlot">new_style_signals_slots</a></p>
<p>你可以通过 <code>PyQt4.QtCore.pyqtSignal</code> 来定义一个信号, 调用新信号的 <code>connect</code> 方法连接一个槽, 然后在合适的时候调用 新信号的 <code>emit</code> 方法:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="kn">import</span> <span class="n">pyqtSignal</span>

<span class="k">def</span> <span class="nf">on_new_solt</span><span class="p">():</span>
    <span class="k">print</span> <span class="sa">u</span><span class="s1">&#39;接收到新信号&#39;</span>

<span class="n">sin_new</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">()</span>  <span class="c1"># 定义新信号</span>
<span class="n">sin_new</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">on_new_solt</span><span class="p">)</span>  <span class="c1"># 连接信号槽</span>
<span class="n">sin_new</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>  <span class="c1"># 发出信号</span>
</pre></div>


<h1>记一次调错</h1>
<p>在开始一个项目的过程中, 遇到一个问题:</p>
<p>假设存在两个 table widget, 我希望为这两个 table widget 自定一个信号槽, 一开始我是这么写的:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="kn">import</span> <span class="n">pyqtSignal</span>

<span class="k">class</span> <span class="nc">ClassName</span><span class="p">(</span><span class="n">Ui_Xxx</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_widget_one</span><span class="o">.</span><span class="n">sin_update</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_widget_one</span><span class="o">.</span><span class="n">sin_update</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_one</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">table_widget_two</span><span class="o">.</span><span class="n">sin_update</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_widget_two</span><span class="o">.</span><span class="n">sin_update</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_two</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_one</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="sa">u</span><span class="s1">&#39;更新第一个 table widget&#39;</span>

    <span class="k">def</span> <span class="nf">update_two</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="sa">u</span><span class="s1">&#39;更新第二个 table widget&#39;</span>
</pre></div>


<p><br>
发现脚本直接跑不起来.... 经探索发现, 信号必须被定义成<code>类成员</code>, 像下面这样:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="kn">import</span> <span class="n">pyqtSignal</span>

<span class="k">class</span> <span class="nc">ClassName</span><span class="p">(</span><span class="n">Ui_Xxx</span><span class="p">):</span>
   <span class="n">table_widget_one</span><span class="o">.</span><span class="n">sin_update</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">()</span>  <span class="c1"># 类成员</span>
   <span class="n">table_widget_two</span><span class="o">.</span><span class="n">sin_update</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">()</span>  <span class="c1"># 类成员</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_widget_one</span><span class="o">.</span><span class="n">sin_update</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_one</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_widget_two</span><span class="o">.</span><span class="n">sin_update</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_two</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_one</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="sa">u</span><span class="s1">&#39;更新第一个 table widget&#39;</span>

    <span class="k">def</span> <span class="nf">update_two</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="sa">u</span><span class="s1">&#39;更新第二个 table widget&#39;</span>
</pre></div>


<p><br>
改过后, 脚本可以跑起来了, 但是发现信号槽关联失败, 再探索发现信号要定义成类的一级成员, 于是我只能再定义个类继承 QTableWedgit:</p>
<div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="kn">import</span> <span class="n">pyqtSignal</span>

<span class="k">class</span> <span class="nc">My_Table_Widget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QTableWidget</span><span class="p">):</span>
    <span class="n">sin_update</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
</pre></div>


<p><br>
然后在 Qt 设计师中让 <code>table_widget_one</code> 和 <code>table_widget_two</code> 提升为 <code>My_Table_Widget</code>, 最后改主脚本为:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="kn">import</span> <span class="n">pyqtSignal</span>

<span class="k">class</span> <span class="nc">ClassName</span><span class="p">(</span><span class="n">Ui_Xxx</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_widget_one</span><span class="o">.</span><span class="n">sin_update</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_one</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_widget_two</span><span class="o">.</span><span class="n">sin_update</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_two</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_one</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="sa">u</span><span class="s1">&#39;更新第一个 table widget&#39;</span>

    <span class="k">def</span> <span class="nf">update_two</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="sa">u</span><span class="s1">&#39;更新第二个 table widget&#39;</span>
</pre></div>
<p class="subheader">Category: <a href="http://blog.smallcpp.cn/category/pyqt.html">PyQt</a>

</p>




<!--      -->

    <!-- 多说评论框 start -->
    <h4>Comments !</h4>
    <div class="ds-thread" data-thread-key="05-pyqt-de-xin-hao-cao" data-title="05、PyQt 的信号槽" data-url="http://blog.smallcpp.cn/05-pyqt-de-xin-hao-cao.html"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
        var duoshuoQuery = {short_name:"smallcpp"};
            (function() {
                var ds = document.createElement('script');
                ds.type = 'text/javascript';ds.async = true;
                ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
                ds.charset = 'UTF-8';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
            })();
    </script>
    <!-- 多说公共JS代码 end -->
</article>
    </div>
    <!-- End Main Content -->

    <!-- Sidebar -->
    <aside class="large-3 columns">
        <h5 class="sidebar-title">Site</h5>
        <ul class="side-nav">
            <li><a href="http://blog.smallcpp.cn/archives.html">Archives</a>
            <li><a href="http://blog.smallcpp.cn/tags.html">Tags</a>
        </ul>

        <h5 class="sidebar-title">Categories</h5>
        <ul class="side-nav">
            <li><a href="http://blog.smallcpp.cn/category/c11.html">C++11</a></li>
            <li><a href="http://blog.smallcpp.cn/category/cocos2d.html">Cocos2d</a></li>
            <li><a href="http://blog.smallcpp.cn/category/da-hua-she-ji-mo-shi.html">大话设计模式</a></li>
            <li><a href="http://blog.smallcpp.cn/category/da-shu-ju.html">大数据</a></li>
            <li><a href="http://blog.smallcpp.cn/category/da-shu-ju-java-ru-men-dao-jing-tong.html">大数据 Java 入门到精通</a></li>
            <li><a href="http://blog.smallcpp.cn/category/da-shu-ju-linux-ru-men-dao-jing-tong.html">大数据 Linux 入门到精通</a></li>
            <li><a href="http://blog.smallcpp.cn/category/da-shu-ju-mongodb-ru-men-dao-jing-tong.html">大数据 Mongodb 入门到精通</a></li>
            <li><a href="http://blog.smallcpp.cn/category/da-shu-ju-redis-ru-men-dao-jing-tong.html">大数据 Redis 入门到精通</a></li>
            <li><a href="http://blog.smallcpp.cn/category/du-shu-bi-ji.html">读书笔记</a></li>
            <li><a href="http://blog.smallcpp.cn/category/golang.html">Golang</a></li>
            <li><a href="http://blog.smallcpp.cn/category/hei-ke-ji.html">黑科技</a></li>
            <li><a href="http://blog.smallcpp.cn/category/java.html">JAVA</a></li>
            <li><a href="http://blog.smallcpp.cn/category/lua.html">Lua</a></li>
            <li><a href="http://blog.smallcpp.cn/category/pyqt.html">PyQt</a></li>
            <li><a href="http://blog.smallcpp.cn/category/python.html">Python</a></li>
            <li><a href="http://blog.smallcpp.cn/category/qt.html">QT</a></li>
            <li><a href="http://blog.smallcpp.cn/category/ruan-jian-she-ji.html">软件设计</a></li>
            <li><a href="http://blog.smallcpp.cn/category/za-xiang.html">杂项</a></li>
        </ul>

        <h5 class="sidebar-title">Links</h5>
        <ul class="side-nav">
            <li><a href="http://blog.csdn.net/u010850265">CSDN</a></li>
        </ul>

        <h5 class="sidebar-title">Social</h5>
        <ul class="side-nav">
            <li><a href="http://blog.csdn.net/u010850265">CSDN</a></li>
        </ul>

    </aside> <!-- End Sidebar -->

</div> <!-- End Main Content and Sidebar -->


<!-- Footer -->
<footer class="row">
    <div class="large-12 columns">
        <hr />
        <div class="row">
            <div class="large-6 columns">
              <!--                  <p>Small Cpp | 勿在浮沙筑高台, 练从难处练, 用从易处用. by martin</p> -->
            </div>
            </div>
    </div>
</footer>
</body>
</html>